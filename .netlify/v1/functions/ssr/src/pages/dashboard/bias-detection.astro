---
import BaseLayout from '@/layouts/BaseLayout.astro'
import BrutalistCard from '@/components/ui/BrutalistCard.astro'
import BrutalistButton from '@/components/ui/BrutalistButton.astro'

export const prerender = false
---

<BaseLayout
  title="Bias Detection Dashboard - Pixelated"
  description="Comprehensive bias detection management and analytics dashboard"
>
  <!-- Hero Section -->
  <section class="brutalist-section mesh-bg-1 relative overflow-hidden">
    <!-- Floating Background Elements -->
    <div
      class="absolute top-20 left-10 w-32 h-32 rounded-full bg-gradient-to-r from-red-500/10 to-orange-500/10 floating-element"
    >
    </div>
    <div
      class="absolute top-40 right-20 w-24 h-24 rounded-full bg-gradient-to-r from-blue-500/10 to-purple-500/10 floating-element--delayed"
    >
    </div>
    <div
      class="absolute bottom-20 left-1/3 w-20 h-20 rounded-full bg-gradient-to-r from-teal-500/10 to-green-500/10 floating-element"
    >
    </div>

    <div class="brutalist-container relative z-10">
      <div class="text-center mb-12">
        <div
          class="inline-flex items-center gap-3 mb-8 nav-pill nav-pill--active"
        >
          <div class="status-dot status-dot--processing"></div>
          <span class="font-bold">BIAS DETECTION DASHBOARD</span>
        </div>

        <h1 class="brutalist-heading text-5xl md:text-7xl mb-6">
          <span class="gradient-text-secondary">ANALYTICS</span>
          <br />
          <span class="gradient-text-primary">COMMAND CENTER</span>
        </h1>

        <p class="text-xl text-gray-300 max-w-4xl mx-auto mb-8">
          Real-time monitoring and management of bias detection across all
          therapeutic interactions. Enterprise-grade analytics with HIPAA
          compliance.
        </p>

        <!-- Status Badges -->
        <div class="flex flex-wrap justify-center gap-4 mb-12">
          <div
            class="nav-pill bg-gradient-to-r from-green-500 to-emerald-500 text-white"
          >
            <svg
              class="w-4 h-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            SYSTEM HEALTHY
          </div>
          <div
            class="nav-pill bg-gradient-to-r from-blue-500 to-cyan-500 text-white"
          >
            <svg
              class="w-4 h-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M13 10V3L4 14h7v7l9-11h-7z"></path>
            </svg>
            REAL-TIME ACTIVE
          </div>
          <div
            class="nav-pill bg-gradient-to-r from-purple-500 to-pink-500 text-white"
          >
            <svg
              class="w-4 h-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"
              ></path>
            </svg>
            HIPAA SECURE
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Main Dashboard Grid -->
  <section class="brutalist-section bg-gray-900/50 mesh-bg-2">
    <div class="brutalist-container">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-12">
        <!-- System Overview -->
        <BrutalistCard variant="elevated" class="lg:col-span-2">
          <div class="space-y-6">
            <div class="border-b border-gray-700 pb-4">
              <h3 class="brutalist-subheading text-xl mb-2">SYSTEM OVERVIEW</h3>
              <p class="text-gray-400 text-sm">
                Real-time system performance and health metrics
              </p>
            </div>

            <!-- Key Metrics -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
              <div class="metric-card">
                <div class="metric-value" id="total-sessions">1,247</div>
                <div class="metric-label">Total Sessions</div>
                <div class="metric-trend trend-up">+12%</div>
              </div>
              <div class="metric-card">
                <div class="metric-value" id="avg-bias-score">23.4%</div>
                <div class="metric-label">Avg Bias Score</div>
                <div class="metric-trend trend-down">-5%</div>
              </div>
              <div class="metric-card">
                <div class="metric-value" id="active-alerts">3</div>
                <div class="metric-label">Active Alerts</div>
                <div class="metric-trend trend-neutral">0%</div>
              </div>
              <div class="metric-card">
                <div class="metric-value" id="system-uptime">99.7%</div>
                <div class="metric-label">System Uptime</div>
                <div class="metric-trend trend-up">+0.2%</div>
              </div>
            </div>

            <!-- Performance Chart Placeholder -->
            <div
              class="bg-gray-800/50 rounded-lg p-6 border border-gray-600/30"
            >
              <h4 class="text-lg font-semibold text-blue-200 mb-4">
                Performance Trends
              </h4>
              <div
                class="h-48 flex items-center justify-center bg-gray-700/30 rounded"
              >
                <div class="text-center text-gray-400">
                  <div class="text-4xl mb-2">üìä</div>
                  <p>Interactive performance charts loading...</p>
                </div>
              </div>
            </div>
          </div>
        </BrutalistCard>

        <!-- Quick Actions -->
        <BrutalistCard variant="elevated">
          <div class="space-y-6">
            <div class="border-b border-gray-700 pb-4">
              <h3 class="brutalist-subheading text-xl mb-2">QUICK ACTIONS</h3>
              <p class="text-gray-400 text-sm">Common management tasks</p>
            </div>

            <div class="space-y-3">
              <BrutalistButton
                href="/demo/bias-detection"
                variant="primary"
                class="w-full"
              >
                üß™ RUN ANALYSIS TEST
              </BrutalistButton>
              <BrutalistButton
                href="/dashboard/bias-detection/reports"
                variant="secondary"
                class="w-full"
              >
                üìä VIEW REPORTS
              </BrutalistButton>
              <BrutalistButton
                href="/dashboard/bias-detection/alerts"
                variant="secondary"
                class="w-full"
              >
                üö® MANAGE ALERTS
              </BrutalistButton>
              <BrutalistButton
                href="/dashboard/bias-detection/settings"
                variant="outline"
                class="w-full"
              >
                ‚öôÔ∏è SYSTEM SETTINGS
              </BrutalistButton>
            </div>

            <!-- System Status -->
            <div
              class="bg-gray-800/50 rounded-lg p-4 border border-gray-600/30"
            >
              <h4 class="text-sm font-semibold text-blue-200 mb-3">
                SYSTEM STATUS
              </h4>
              <div class="space-y-2">
                <div class="flex items-center justify-between">
                  <span class="text-sm text-gray-300">ML Models</span>
                  <span class="text-green-400 text-sm">‚úì Active</span>
                </div>
                <div class="flex items-center justify-between">
                  <span class="text-sm text-gray-300">API Services</span>
                  <span class="text-green-400 text-sm">‚úì Online</span>
                </div>
                <div class="flex items-center justify-between">
                  <span class="text-sm text-gray-300">Database</span>
                  <span class="text-green-400 text-sm">‚úì Connected</span>
                </div>
                <div class="flex items-center justify-between">
                  <span class="text-sm text-gray-300">Security</span>
                  <span class="text-green-400 text-sm">‚úì Compliant</span>
                </div>
              </div>
            </div>
          </div>
        </BrutalistCard>
      </div>

      <!-- Recent Activity & Alerts -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Recent Analyses -->
        <BrutalistCard variant="elevated">
          <div class="space-y-6">
            <div class="border-b border-gray-700 pb-4">
              <h3 class="brutalist-subheading text-xl mb-2">RECENT ANALYSES</h3>
              <p class="text-gray-400 text-sm">
                Latest bias detection sessions
              </p>
            </div>

            <div class="space-y-4" id="recent-analyses">
              <!-- Dynamic content will be loaded here -->
              <div class="text-center py-8 text-gray-400">
                <div class="text-3xl mb-2">üîÑ</div>
                <p>Loading recent analyses...</p>
              </div>
            </div>
          </div>
        </BrutalistCard>

        <!-- Active Alerts -->
        <BrutalistCard variant="elevated">
          <div class="space-y-6">
            <div class="border-b border-gray-700 pb-4">
              <h3 class="brutalist-subheading text-xl mb-2">ACTIVE ALERTS</h3>
              <p class="text-gray-400 text-sm">Current bias detection alerts</p>
            </div>

            <div class="space-y-4" id="active-alerts">
              <!-- Dynamic content will be loaded here -->
              <div class="text-center py-8 text-gray-400">
                <div class="text-3xl mb-2">üîî</div>
                <p>No active alerts</p>
              </div>
            </div>
          </div>
        </BrutalistCard>
      </div>
    </div>
  </section>

  <!-- Advanced Analytics Section -->
  <section class="brutalist-section">
    <div class="brutalist-container">
      <div class="text-center mb-12">
        <h2 class="brutalist-heading text-3xl md:text-5xl mb-4">
          ADVANCED
          <span class="gradient-text-primary">ANALYTICS</span>
        </h2>
        <p class="text-lg text-gray-300">
          Deep insights into bias patterns and system performance
        </p>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        <!-- Bias Distribution -->
        <BrutalistCard hover={true}>
          <div class="text-center">
            <div class="text-4xl mb-4">üìà</div>
            <h3 class="brutalist-subheading text-lg mb-3">BIAS DISTRIBUTION</h3>
            <p class="text-gray-400 text-sm mb-4">
              Statistical analysis of bias scores across different demographics
              and scenarios.
            </p>
            <BrutalistButton
              href="/dashboard/bias-detection/analytics/bias-distribution"
              variant="secondary"
              size="sm"
            >
              VIEW ANALYSIS ‚Üí
            </BrutalistButton>
          </div>
        </BrutalistCard>

        <!-- Performance Metrics -->
        <BrutalistCard hover={true}>
          <div class="text-center">
            <div class="text-4xl mb-4">‚ö°</div>
            <h3 class="brutalist-subheading text-lg mb-3">
              PERFORMANCE METRICS
            </h3>
            <p class="text-gray-400 text-sm mb-4">
              Real-time monitoring of system performance, response times, and
              accuracy metrics.
            </p>
            <BrutalistButton
              href="/dashboard/bias-detection/analytics/performance"
              variant="secondary"
              size="sm"
            >
              VIEW METRICS ‚Üí
            </BrutalistButton>
          </div>
        </BrutalistCard>

        <!-- Compliance Reports -->
        <BrutalistCard hover={true}>
          <div class="text-center">
            <div class="text-4xl mb-4">üìã</div>
            <h3 class="brutalist-subheading text-lg mb-3">
              COMPLIANCE REPORTS
            </h3>
            <p class="text-gray-400 text-sm mb-4">
              HIPAA compliance monitoring, audit trails, and regulatory
              reporting.
            </p>
            <BrutalistButton
              href="/dashboard/bias-detection/analytics/compliance"
              variant="secondary"
              size="sm"
            >
              VIEW REPORTS ‚Üí
            </BrutalistButton>
          </div>
        </BrutalistCard>
      </div>
    </div>
  </section>

  <!-- Call to Action -->
  <section class="brutalist-section bg-gray-900/50">
    <div class="brutalist-container">
      <div class="mental-health-safe max-w-4xl mx-auto text-center">
        <div class="text-5xl mb-6">üéØ</div>

        <h2 class="brutalist-heading text-3xl md:text-5xl mb-6">
          TAKE CONTROL OF
          <br />
          <span class="gradient-text-primary">BIAS DETECTION</span>
        </h2>

        <p class="text-xl text-gray-300 mb-8">
          Advanced analytics and real-time monitoring for comprehensive bias
          management. Enterprise-grade insights with actionable recommendations.
        </p>

        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <BrutalistButton
            href="/demo/bias-detection"
            variant="primary"
            size="lg"
          >
            üöÄ START ANALYSIS
          </BrutalistButton>
          <BrutalistButton
            href="/docs/bias-detection"
            variant="secondary"
            size="lg"
          >
            üìñ VIEW DOCUMENTATION
          </BrutalistButton>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>

<style>
  .metric-card {
    @apply bg-gray-800/50 rounded-lg p-4 border border-gray-600/30 text-center;
  }

  .metric-value {
    @apply text-2xl font-bold text-blue-300 mb-1;
  }

  .metric-label {
    @apply text-sm text-gray-400;
  }

  .metric-trend {
    @apply text-xs font-medium mt-1;
  }

  .trend-up {
    @apply text-green-400;
  }

  .trend-down {
    @apply text-red-400;
  }

  .trend-neutral {
    @apply text-gray-400;
  }

  /* Floating animations */
  .floating-element {
    animation: float 6s ease-in-out infinite;
  }

  .floating-element--delayed {
    animation: float 6s ease-in-out infinite;
    animation-delay: 2s;
  }

  @keyframes float {
    0%,
    100% {
      transform: translateY(0px);
    }
    50% {
      transform: translateY(-20px);
    }
  }

  /* Status dots */
  .status-dot {
    @apply w-3 h-3 rounded-full;
  }

  .status-dot--processing {
    @apply bg-blue-400 animate-pulse;
  }

  /* Gradient text */
  .gradient-text-primary {
    @apply bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent;
  }

  .gradient-text-secondary {
    @apply bg-gradient-to-r from-red-400 to-orange-500 bg-clip-text text-transparent;
  }

  /* Mesh backgrounds */
  .mesh-bg-1 {
    background-image:
      radial-gradient(
        circle at 25% 25%,
        rgba(120, 119, 198, 0.1) 0%,
        transparent 50%
      ),
      radial-gradient(
        circle at 75% 75%,
        rgba(255, 119, 198, 0.1) 0%,
        transparent 50%
      );
  }

  .mesh-bg-2 {
    background-image:
      radial-gradient(
        circle at 20% 80%,
        rgba(120, 119, 198, 0.05) 0%,
        transparent 50%
      ),
      radial-gradient(
        circle at 80% 20%,
        rgba(255, 119, 198, 0.05) 0%,
        transparent 50%
      );
  }
</style>

<script>
  class BiasDetectionDashboard {
    constructor() {
      this.initializeDashboard()
      this.startRealTimeUpdates()
    }

    async initializeDashboard() {
      try {
        // Load dashboard data
        const response = await fetch('/api/dashboard/bias-detection/summary')
        if (response.ok) {
          const data = await response.json()
          this.updateDashboard(data)
        }
      } catch (error) {
        console.warn('Dashboard data loading failed:', error)
        // Continue with default values
      }
    }

    updateDashboard(data: any) {
      // Update metrics
      if (data.metrics) {
        Object.entries(data.metrics).forEach(([key, value]: [string, any]) => {
          const element = document.getElementById(key)
          if (element) {
            element.textContent = value
          }
        })
      }

      // Update recent analyses
      if (data.recentAnalyses) {
        this.renderRecentAnalyses(data.recentAnalyses)
      }

      // Update alerts
      if (data.activeAlerts) {
        this.renderActiveAlerts(data.activeAlerts)
      }
    }

    renderRecentAnalyses(analyses: any[]) {
      const container = document.getElementById('recent-analyses')
      if (!container || !analyses.length) return

      container.innerHTML = analyses
        .map(
          (analysis) => `
        <div class="bg-gray-800/30 rounded-lg p-4 border border-gray-600/20">
          <div class="flex items-center justify-between mb-2">
            <span class="font-medium text-gray-200">${analysis.sessionType}</span>
            <span class="text-sm px-2 py-1 rounded ${
              analysis.biasScore > 0.6
                ? 'bg-red-500/20 text-red-300'
                : analysis.biasScore > 0.3
                  ? 'bg-yellow-500/20 text-yellow-300'
                  : 'bg-green-500/20 text-green-300'
            }">
              ${(analysis.biasScore * 100).toFixed(1)}%
            </span>
          </div>
          <div class="text-sm text-gray-400">
            ${new Date(analysis.timestamp).toLocaleString()}
          </div>
        </div>
      `,
        )
        .join('')
    }

    renderActiveAlerts(alerts: any[]) {
      const container = document.getElementById('active-alerts')
      if (!container) return

      if (!alerts.length) {
        container.innerHTML = `
          <div class="text-center py-8 text-gray-400">
            <div class="text-3xl mb-2">‚úÖ</div>
            <p>No active alerts</p>
          </div>
        `
        return
      }

      container.innerHTML = alerts
        .map(
          (alert) => `
        <div class="bg-red-500/10 border border-red-400/30 rounded-lg p-4">
          <div class="flex items-start gap-3">
            <div class="w-2 h-2 bg-red-400 rounded-full mt-2 flex-shrink-0"></div>
            <div>
              <div class="font-medium text-red-200">${alert.title}</div>
              <div class="text-sm text-red-300/80 mt-1">${alert.description}</div>
              <div class="text-xs text-red-400/60 mt-2">
                ${new Date(alert.timestamp).toLocaleString()}
              </div>
            </div>
          </div>
        </div>
      `,
        )
        .join('')
    }

    startRealTimeUpdates() {
      // Update uptime counter
      setInterval(() => {
        const uptimeEl = document.getElementById('system-uptime')
        if (uptimeEl) {
          const current = parseFloat(uptimeEl.textContent || '99.7')
          const newValue = Math.max(
            99.0,
            Math.min(100.0, current + (Math.random() - 0.5) * 0.1),
          )
          uptimeEl.textContent = newValue.toFixed(1) + '%'
        }
      }, 30000) // Update every 30 seconds
    }
  }

  // Initialize dashboard when page loads
  document.addEventListener('DOMContentLoaded', () => {
    new BiasDetectionDashboard()
  })
</script>
