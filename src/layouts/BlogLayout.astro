---
import BaseHead from '@/components/base/Head.astro'
import Navbar from '@/components/mizu/Navbar.astro'
import Footer from '@/components/mizu/Footer.astro'
import ToTopButton from '@/components/widgets/ToTopButton.astro'
import { BlogSearch } from '@/components/BlogSearch'

interface Props {
  title: string
  description?: string
  image?: string
  canonicalURL?: string
  pubDate?: Date
  author?: string
  tags?: string[]
}

const {
  title,
  description = 'A blog post',
  image = '/images/blog-default.jpg',
  pubDate,
  author,
  tags = [],
} = Astro.props

// Format date if provided
const formattedDate = pubDate?.toLocaleDateString('en-us', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
})
---

<!doctype html>
<html lang="en" class="dark scroll-smooth">
  <head>
    <BaseHead {title} {description} ogImage={image} />

    <meta name="color-scheme" content="dark" />
    <meta name="theme-color" content="#0f172a" />

    <link rel="stylesheet" href="/css/unified-dark-theme-v3.css" />
    <link rel="stylesheet" href="/css/design-system.css" />
    <link rel="stylesheet" href="/css/unified-blended-theme.css" />

    <link rel="stylesheet" href="/css/fonts.css" />
    <link rel="stylesheet" href="/css/font-fix.css" />

    <link rel="stylesheet" href="/css/background-fixes.css" />

    <script src="/js/polyfill-detector.js" is:inline></script>
    <script src="/js/module-loader.js" defer is:inline></script>
    <script src="/js/background-loader.js" defer is:inline></script>

    <!-- Structured data for blog post -->
    {
      pubDate && author && (
        <script
          is:inline
          type="application/ld+json"
          set:html={JSON.stringify({
            '@context': 'https://schema.org',
            '@type': 'BlogPosting',
            'headline': title,
            'image': [image],
            'datePublished': pubDate.toISOString(),
            'author': [
              {
                '@type': 'Person',
                'name': author,
              },
            ],
          })}
        />
      )
    }
  </head>

  <body
    class="bg-slate-950 text-slate-50 font-sans min-h-screen flex flex-col overflow-x-hidden selection:bg-indigo-500/30"
  >
    <Navbar />

    <main class="container-refined py-12">
      <article class="prose prose-lg dark:prose-invert mx-auto max-w-4xl">
        <!-- Blog post header -->
        <header class="mb-8">
          <h1 class="text-4xl font-bold mb-4">{title}</h1>
          {
            formattedDate && (
              <time
                datetime={pubDate?.toISOString()}
                class="text-muted-foreground"
              >
                {formattedDate}
              </time>
            )
          }
          {author && <p class="text-muted-foreground mt-2">By {author}</p>}
          {
            tags.length > 0 && (
              <div class="flex gap-2 mt-4">
                {tags.map((tag: unknown) => (
                  <a
                    href={`/blog/tags/${tag}`}
                    class="text-sm px-3 py-1 bg-muted rounded-full hover:bg-muted/80 transition-colors"
                    transition:animate="slide"
                    data-astro-prefetch
                  >
                    {tag}
                  </a>
                ))}
              </div>
            )
          }
        </header>

        <!-- Blog post content -->
        <div class="blog-content">
          <BlogSearch client:load />
          <slot />
        </div>
      </article>
    </main>

    <Footer />
    <ToTopButton />
    <script is:inline>
      function speedInsightsBeforeSend(data) {
        console.log('Speed Insights before send', data)
        return data
      }
    </script>
  </body>
</html>
