name: GKE Deployment Pipeline

on:
  push:
    branches: [master]
  pull_request:
    branches: [master]
  workflow_dispatch:

jobs:
  verify-dockerfile:
    name: Verify Dockerfile
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v6

      - name: Verify Dockerfile exists
        run: |
          echo "üîç Verifying Dockerfile location..."
          echo "üìÇ Current working directory: $(pwd)"
          echo "üìÇ GitHub workspace: ${{ github.workspace }}"

          # Change to the GitHub workspace directory
          cd "${{ github.workspace }}" || { echo "‚ùå Failed to change to workspace directory"; exit 1; }

          # Verify checkout succeeded by checking for common files
          if [[ ! -f "package.json" ]]; then
            echo "‚ùå Checkout verification failed - package.json not found!"
            echo "üìÇ Current directory contents:"
            ls -la
            echo "üìÇ Expected workspace: ${{ github.workspace }}"
            echo "üìÇ Git configuration:"
            ls -la .git || echo ".git directory not found"
            exit 1
          fi

          # Check for Dockerfile in root
          if [[ -f "Dockerfile" ]]; then
            echo "‚úÖ Dockerfile found at: ${{ github.workspace }}/Dockerfile"
            echo "üìÑ Dockerfile size: $(stat -c%s Dockerfile) bytes"
          else
            echo "‚ùå Dockerfile not found in root directory"
            echo "üìÇ Current directory contents:"
            ls -la | head -20
            echo "üìÇ Looking for Dockerfile in repository:"
            find "${{ github.workspace }}" -name "Dockerfile" -type f 2>/dev/null | head -10 || echo "No Dockerfile found"
            echo "‚ùå Dockerfile verification failed!"
            exit 1
          fi