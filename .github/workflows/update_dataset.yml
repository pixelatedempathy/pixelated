name: Update Mental Health Dataset

on:
  schedule:
    # Run every Sunday at midnight
    - cron: '0 0 * * 0'
  workflow_dispatch:
  # Allow manual trigger

jobs:
  update-dataset:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Code
      uses: actions/checkout@v3

    - name: Install uv (Python Package Manager)
      uses: astral-sh/setup-uv@v1

    - name: Set up Python
      run: uv python install 3.11

    - name: Install Dependencies
      run: |
        uv sync
        

    - name: Run Pipeline (Sourcing -> Synthesis)
      env:
        # Secrets would be configured in repo settings if real keys were used
        # OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }} 
        # SEMANTIC_SCHOLAR_API_KEY: ${{ secrets.SEMANTIC_SCHOLAR_API_KEY }}
        PYTHONPATH: .
      run: |
        uv run python ai/main.py
        

    - name: Upload Artifacts
      uses: actions/upload-artifact@v3
      with:
        name: final-dataset
        path: ai/training_ready/datasets/final_instruct/final_train.jsonl
        retention-days: 90