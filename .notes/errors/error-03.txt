[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m348[0m     })
[7m   [0m [91m~~~~~[0m
[96msrc/lib/auth/jwt-service.ts[0m:[93m345[0m:[93m46[0m - [91merror[0m[90m ts(2339): [0mProperty 'TOKEN_VALIDATED' does not exist on type 'typeof SecurityEventType'.

[7m345[0m     await logSecurityEvent(SecurityEventType.TOKEN_VALIDATED, payload.sub, {
[7m   [0m [91m                                             ~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/jwt-service.ts[0m:[93m331[0m:[93m30[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'string | undefined' is not assignable to parameter of type 'string'.
  Type 'undefined' is not assignable to type 'string'.

[7m331[0m     if (await isTokenRevoked(payload.jti)) {
[7m   [0m [91m                             ~~~~~~~~~~~[0m
[96msrc/lib/auth/jwt-service.ts[0m:[93m326[0m:[93m9[0m - [91merror[0m[90m ts(18048): [0m'payload.exp' is possibly 'undefined'.

[7m326[0m     if (payload.exp < currentTimestamp()) {
[7m   [0m [91m        ~~~~~~~~~~~[0m
[96msrc/lib/auth/jwt-service.ts[0m:[93m283[0m:[93m67[0m - [91merror[0m[90m ts(2554): [0mExpected 2 arguments, but got 3.

[7m283[0m   await logSecurityEvent(SecurityEventType.TOKEN_CREATED, userId, {
[7m   [0m [91m                                                                  ~[0m
[7m284[0m     accessTokenId: accessTokenId,
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m...[0m 
[7m286[0m     clientInfo: clientInfo,
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m287[0m   })
[7m   [0m [91m~~~[0m
[96msrc/lib/auth/jwt-service.ts[0m:[93m283[0m:[93m44[0m - [91merror[0m[90m ts(2339): [0mProperty 'TOKEN_CREATED' does not exist on type 'typeof SecurityEventType'.

[7m283[0m   await logSecurityEvent(SecurityEventType.TOKEN_CREATED, userId, {
[7m   [0m [91m                                           ~~~~~~~~~~~~~[0m
[96msrc/lib/auth/jwt-service.ts[0m:[93m275[0m:[93m44[0m - [91merror[0m[90m ts(2345): [0mArgument of type '{ userId: string; type: "refresh"; expiresAt: number; accessTokenId: string; }' is not assignable to parameter of type '{ userId: string; role: UserRole; type: TokenType; expiresAt: number; clientInfo?: ClientInfo | undefined; accessTokenId?: string | undefined; }'.
  Property 'role' is missing in type '{ userId: string; type: "refresh"; expiresAt: number; accessTokenId: string; }' but required in type '{ userId: string; role: UserRole; type: TokenType; expiresAt: number; clientInfo?: ClientInfo | undefined; accessTokenId?: string | undefined; }'.

[7m275[0m   await storeTokenMetadata(refreshTokenId, {
[7m   [0m [91m                                           ~[0m
[7m276[0m     userId: userId,
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~[0m
[7m...[0m 
[7m279[0m     accessTokenId: accessTokenId,
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m280[0m   })
[7m   [0m [91m~~~[0m
[96msrc/lib/auth/jwt-service.ts[0m:[93m478[0m:[93m7[0m - [93mwarning[0m[90m ts(80007): [0m'await' has no effect on the type of this expression.

[7m478[0m       await logSecurityEvent(
[7m   [0m [93m      ~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m479[0m         SecurityEventType.TOKEN_CLEANED_UP,
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m...[0m 
[7m484[0m         },
[7m   [0m [93m~~~~~~~~~~[0m
[7m485[0m       )
[7m   [0m [93m~~~~~~~[0m
[96msrc/lib/auth/jwt-service.ts[0m:[93m444[0m:[93m5[0m - [93mwarning[0m[90m ts(80007): [0m'await' has no effect on the type of this expression.

[7m444[0m     await logSecurityEvent(SecurityEventType.TOKEN_REVOKED, metadata.userId, {
[7m   [0m [93m    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m445[0m       tokenId: tokenId,
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m...[0m 
[7m447[0m       tokenType: metadata.type,
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m448[0m     })
[7m   [0m [93m~~~~~~[0m
[96msrc/lib/auth/jwt-service.ts[0m:[93m405[0m:[93m3[0m - [93mwarning[0m[90m ts(80007): [0m'await' has no effect on the type of this expression.

[7m405[0m   await logSecurityEvent(
[7m   [0m [93m  ~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m406[0m     SecurityEventType.TOKEN_REFRESHED,
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m...[0m 
[7m412[0m     },
[7m   [0m [93m~~~~~~[0m
[7m413[0m   )
[7m   [0m [93m~~~[0m
[96msrc/lib/auth/jwt-service.ts[0m:[93m360[0m:[93m5[0m - [93mwarning[0m[90m ts(80007): [0m'await' has no effect on the type of this expression.

[7m360[0m     await logSecurityEvent(SecurityEventType.TOKEN_VALIDATION_FAILED, null, {
[7m   [0m [93m    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m361[0m       error: error instanceof Error ? error.message : 'Unknown error',
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m362[0m       tokenType: tokenType,
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m363[0m     })
[7m   [0m [93m~~~~~~[0m
[96msrc/lib/auth/jwt-service.ts[0m:[93m345[0m:[93m5[0m - [93mwarning[0m[90m ts(80007): [0m'await' has no effect on the type of this expression.

[7m345[0m     await logSecurityEvent(SecurityEventType.TOKEN_VALIDATED, payload.sub, {
[7m   [0m [93m    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m346[0m       tokenId: payload.jti,
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m347[0m       tokenType: tokenType,
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m348[0m     })
[7m   [0m [93m~~~~~~[0m
[96msrc/lib/auth/jwt-service.ts[0m:[93m283[0m:[93m3[0m - [93mwarning[0m[90m ts(80007): [0m'await' has no effect on the type of this expression.

[7m283[0m   await logSecurityEvent(SecurityEventType.TOKEN_CREATED, userId, {
[7m   [0m [93m  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m284[0m     accessTokenId: accessTokenId,
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m...[0m 
[7m286[0m     clientInfo: clientInfo,
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m287[0m   })
[7m   [0m [93m~~~~[0m

[96msrc/lib/auth/jwt-token-service.ts[0m:[93m622[0m:[93m22[0m - [91merror[0m[90m ts(2551): [0mProperty 'setex' does not exist on type 'RedisClientType'. Did you mean 'setEx'?

[7m622[0m     await this.redis.setex(recentUseKey, 300, '1')
[7m   [0m [91m                     ~~~~~[0m
[96msrc/lib/auth/jwt-token-service.ts[0m:[93m532[0m:[93m22[0m - [91merror[0m[90m ts(2551): [0mProperty 'setex' does not exist on type 'RedisClientType'. Did you mean 'setEx'?

[7m532[0m     await this.redis.setex(
[7m   [0m [91m                     ~~~~~[0m
[96msrc/lib/auth/jwt-token-service.ts[0m:[93m513[0m:[93m15[0m - [91merror[0m[90m ts(2554): [0mExpected 2 arguments, but got 1.

[7m513[0m         throw new TokenValidationError('Potential replay attack detected')
[7m   [0m [91m              ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/jwt-token-service.ts[0m:[93m509[0m:[93m11[0m - [91merror[0m[90m ts(2345): [0mArgument of type '"replay_attack_detected"' is not assignable to parameter of type 'SecurityEventType'.

[7m509[0m           'replay_attack_detected',
[7m   [0m [91m          ~~~~~~~~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/jwt-token-service.ts[0m:[93m500[0m:[93m15[0m - [91merror[0m[90m ts(2554): [0mExpected 2 arguments, but got 1.

[7m500[0m         throw new TokenValidationError('User-Agent mismatch detected')
[7m   [0m [91m              ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/jwt-token-service.ts[0m:[93m496[0m:[93m11[0m - [91merror[0m[90m ts(2345): [0mArgument of type '"user_agent_mismatch"' is not assignable to parameter of type 'SecurityEventType'.

[7m496[0m           'user_agent_mismatch',
[7m   [0m [91m          ~~~~~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/jwt-token-service.ts[0m:[93m488[0m:[93m15[0m - [91merror[0m[90m ts(2554): [0mExpected 2 arguments, but got 1.

[7m488[0m         throw new TokenValidationError('IP address mismatch detected')
[7m   [0m [91m              ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/jwt-token-service.ts[0m:[93m485[0m:[93m52[0m - [91merror[0m[90m ts(2345): [0mArgument of type '"ip_mismatch"' is not assignable to parameter of type 'SecurityEventType'.

[7m485[0m         await this.securityLogger.logSecurityEvent('ip_mismatch', payload.sub, {
[7m   [0m [91m                                                   ~~~~~~~~~~~~~[0m
[96msrc/lib/auth/jwt-token-service.ts[0m:[93m469[0m:[93m56[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'unknown' is not assignable to parameter of type 'Error'.

[7m469[0m       await this.securityLogger.logTokenCleanupFailure(error)
[7m   [0m [91m                                                       ~~~~~[0m
[96msrc/lib/auth/jwt-token-service.ts[0m:[93m458[0m:[93m22[0m - [91merror[0m[90m ts(2339): [0mProperty 'id' does not exist on type 'TokenMetadata'.

[7m458[0m             metadata.id,
[7m   [0m [91m                     ~~[0m
[96msrc/lib/auth/jwt-token-service.ts[0m:[93m453[0m:[93m60[0m - [91merror[0m[90m ts(2339): [0mProperty 'id' does not exist on type 'TokenMetadata'.

[7m453[0m           await this.cacheService.invalidateToken(metadata.id)
[7m   [0m [91m                                                           ~~[0m
[96msrc/lib/auth/jwt-token-service.ts[0m:[93m426[0m:[93m68[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'unknown' is not assignable to parameter of type 'Error'.

[7m426[0m       await this.securityLogger.logTokenRevocationFailure(tokenId, error)
[7m   [0m [91m                                                                   ~~~~~[0m
[96msrc/lib/auth/jwt-token-service.ts[0m:[93m411[0m:[93m9[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'import("/home/vivi/pixelated/src/lib/auth/jwt-token-service").TokenType' is not assignable to parameter of type 'Record<string, unknown>'.

[7m411[0m         metadata.type,
[7m   [0m [91m        ~~~~~~~~~~~~~[0m
[96msrc/lib/auth/jwt-token-service.ts[0m:[93m402[0m:[93m11[0m - [91merror[0m[90m ts(2345): [0mArgument of type '"linked_revocation"' is not assignable to parameter of type 'RevocationReason'.

[7m402[0m           'linked_revocation',
[7m   [0m [91m          ~~~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/jwt-token-service.ts[0m:[93m396[0m:[93m57[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'string' is not assignable to parameter of type 'RevocationReason'.

[7m396[0m       await this.revocationService.revokeToken(tokenId, reason)
[7m   [0m [91m                                                        ~~~~~~[0m
[96msrc/lib/auth/jwt-token-service.ts[0m:[93m377[0m:[93m56[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'unknown' is not assignable to parameter of type 'Error'.

[7m377[0m       await this.securityLogger.logTokenRefreshFailure(error)
[7m   [0m [91m                                                       ~~~~~[0m
[96msrc/lib/auth/jwt-token-service.ts[0m:[93m358[0m:[93m9[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'UserRole | undefined' is not assignable to parameter of type 'UserRole'.
  Type 'undefined' is not assignable to type 'UserRole'.

[7m358[0m         validation.role,
[7m   [0m [91m        ~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/jwt-token-service.ts[0m:[93m351[0m:[93m11[0m - [91merror[0m[90m ts(2345): [0mArgument of type '"refresh_cycle"' is not assignable to parameter of type 'RevocationReason'.

[7m351[0m           'refresh_cycle',
[7m   [0m [91m          ~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/jwt-token-service.ts[0m:[93m344[0m:[93m9[0m - [91merror[0m[90m ts(2345): [0mArgument of type '"refresh_token_used"' is not assignable to parameter of type 'RevocationReason'.

[7m344[0m         'refresh_token_used',
[7m   [0m [91m        ~~~~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/jwt-token-service.ts[0m:[93m329[0m:[93m65[0m - [91merror[0m[90m ts(2345): [0mArgument of type '"refresh"' is not assignable to parameter of type 'TokenType'.

[7m329[0m       const validation = await this.validateToken(refreshToken, 'refresh')
[7m   [0m [91m                                                                ~~~~~~~~~[0m
[96msrc/lib/auth/jwt-token-service.ts[0m:[93m306[0m:[93m59[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'unknown' is not assignable to parameter of type 'Error'.

[7m306[0m       await this.securityLogger.logTokenValidationFailure(error, tokenType)
[7m   [0m [91m                                                          ~~~~~[0m
[96msrc/lib/auth/jwt-token-service.ts[0m:[93m283[0m:[93m15[0m - [91merror[0m[90m ts(2554): [0mExpected 2 arguments, but got 1.

[7m283[0m         throw new TokenValidationError('Token metadata not found')
[7m   [0m [91m              ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/jwt-token-service.ts[0m:[93m277[0m:[93m15[0m - [91merror[0m[90m ts(2554): [0mExpected 2 arguments, but got 1.

[7m277[0m         throw new TokenValidationError('Token has been revoked')
[7m   [0m [91m              ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/jwt-token-service.ts[0m:[93m272[0m:[93m15[0m - [91merror[0m[90m ts(2554): [0mExpected 2 arguments, but got 1.

[7m272[0m         throw new TokenValidationError('Token has expired')
[7m   [0m [91m              ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/jwt-token-service.ts[0m:[93m264[0m:[93m15[0m - [91merror[0m[90m ts(2554): [0mExpected 2 arguments, but got 1.

[7m264[0m         throw new TokenValidationError(
[7m   [0m [91m              ~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m265[0m           `Invalid token type: expected ${tokenType}, got ${payload.type}`,
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m266[0m         )
[7m   [0m [91m~~~~~~~~~[0m
[96msrc/lib/auth/jwt-token-service.ts[0m:[93m240[0m:[93m67[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'unknown' is not assignable to parameter of type 'Error'.

[7m240[0m       await this.securityLogger.logTokenGenerationFailure(userId, error)
[7m   [0m [91m                                                                  ~~~~~[0m
[96msrc/lib/auth/jwt-token-service.ts[0m:[93m207[0m:[93m9[0m - [91merror[0m[90m ts(2322): [0mType '"refresh"' is not assignable to type 'TokenType'.

[7m207[0m         type: 'refresh',
[7m   [0m [91m        ~~~~[0m
[96msrc/lib/auth/jwt-token-service.ts[0m:[93m200[0m:[93m9[0m - [91merror[0m[90m ts(2322): [0mType '"access"' is not assignable to type 'TokenType'.

[7m200[0m         type: 'access',
[7m   [0m [91m        ~~~~[0m
[96msrc/lib/auth/jwt-token-service.ts[0m:[93m184[0m:[93m9[0m - [91merror[0m[90m ts(2353): [0mObject literal may only specify known properties, and 'accessTokenId' does not exist in type 'JWTPayload'.

[7m184[0m         accessTokenId,
[7m   [0m [91m        ~~~~~~~~~~~~~[0m
[96msrc/lib/auth/jwt-token-service.ts[0m:[93m13[0m:[93m42[0m - [91merror[0m[90m ts(2307): [0mCannot find module './phase6-integration' or its corresponding type declarations.

[7m13[0m import { Phase6IntegrationService } from './phase6-integration'
[7m  [0m [91m                                         ~~~~~~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/jwt-token-service.ts[0m:[93m12[0m:[93m10[0m - [91merror[0m[90m ts(2305): [0mModule '"./better-auth-integration"' has no exported member 'BetterAuthIntegrationService'.

[7m12[0m import { BetterAuthIntegrationService } from './better-auth-integration'
[7m  [0m [91m         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/jwt-token-service.ts[0m:[93m10[0m:[93m10[0m - [91merror[0m[90m ts(2305): [0mModule '"../redis"' has no exported member 'getRedisClient'.

[7m10[0m import { getRedisClient } from '../redis'
[7m  [0m [91m         ~~~~~~~~~~~~~~[0m

[96msrc/lib/auth/middleware.ts[0m:[93m142[0m:[93m21[0m - [91merror[0m[90m ts(2349): [0mThis expression is not callable.
  No constituent of type 'string | string[]' is callable.

[7m142[0m     request.headers.get?.('X-CSRF-Token') ||
[7m   [0m [91m                    ~~~[0m
[96msrc/lib/auth/middleware.ts[0m:[93m164[0m:[93m3[0m - [93mwarning[0m[90m ts(6133): [0m'request' is declared but its value is never read.

[7m164[0m   request: Request,
[7m   [0m [93m  ~~~~~~~[0m
[96msrc/lib/auth/middleware.ts[0m:[93m113[0m:[93m3[0m - [93mwarning[0m[90m ts(6133): [0m'windowMinutes' is declared but its value is never read.

[7m113[0m   windowMinutes: number,
[7m   [0m [93m  ~~~~~~~~~~~~~[0m
[96msrc/lib/auth/middleware.ts[0m:[93m112[0m:[93m3[0m - [93mwarning[0m[90m ts(6133): [0m'limit' is declared but its value is never read.

[7m112[0m   limit: number,
[7m   [0m [93m  ~~~~~[0m
[96msrc/lib/auth/middleware.ts[0m:[93m111[0m:[93m3[0m - [93mwarning[0m[90m ts(6133): [0m'endpoint' is declared but its value is never read.

[7m111[0m   endpoint: string,
[7m   [0m [93m  ~~~~~~~~[0m
[96msrc/lib/auth/middleware.ts[0m:[93m58[0m:[93m3[0m - [93mwarning[0m[90m ts(6133): [0m'request' is declared but its value is never read.

[7m58[0m   request: Request,
[7m  [0m [93m  ~~~~~~~[0m

[96msrc/lib/auth/role-transitions.ts[0m:[93m950[0m:[93m12[0m - [91merror[0m[90m ts(2304): [0mCannot find name 'validation'.

[7m950[0m     return validation
[7m   [0m [91m           ~~~~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m949[0m:[93m5[0m - [91merror[0m[90m ts(2304): [0mCannot find name 'validation'.

[7m949[0m     validation.restrictions.push('Validation failed due to system error')
[7m   [0m [91m    ~~~~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m924[0m:[93m42[0m - [91merror[0m[90m ts(2339): [0mProperty 'role' does not exist on type '{}'.

[7m924[0m       const currentRole = targetUserAuth.role
[7m   [0m [91m                                         ~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m837[0m:[93m24[0m - [91merror[0m[90m ts(2345): [0mArgument of type '{}' is not assignable to parameter of type 'RoleTransitionAuditLog'.
  Type '{}' is missing the following properties from type 'RoleTransitionAuditLog': id, requestId, userId, action, and 9 more.

[7m837[0m         auditLogs.push(auditLog)
[7m   [0m [91m                       ~~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m832[0m:[93m32[0m - [91merror[0m[90m ts(2339): [0mProperty 'slice' does not exist on type '{}'.

[7m832[0m     const recentIds = auditIds.slice(-limit)
[7m   [0m [91m                               ~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m766[0m:[93m7[0m - [91merror[0m[90m ts(2554): [0mExpected 2 arguments, but got 3.

[7m766[0m       {
[7m   [0m [91m      ~[0m
[7m767[0m         action: auditLog.action,
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m...[0m 
[7m771[0m         actorRole: auditLog.actorRole,
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m772[0m       },
[7m   [0m [91m~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m764[0m:[93m7[0m - [91merror[0m[90m ts(2693): [0m'SecurityEventType' only refers to a type, but is being used as a value here.

[7m764[0m       SecurityEventType.ROLE_TRANSITION_AUDIT,
[7m   [0m [91m      ~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m753[0m:[93m39[0m - [91merror[0m[90m ts(2339): [0mProperty 'slice' does not exist on type '{}'.

[7m753[0m       userAuditTrail = userAuditTrail.slice(-100)
[7m   [0m [91m                                      ~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m752[0m:[93m24[0m - [91merror[0m[90m ts(2339): [0mProperty 'length' does not exist on type '{}'.

[7m752[0m     if (userAuditTrail.length > 100) {
[7m   [0m [91m                       ~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m749[0m:[93m20[0m - [91merror[0m[90m ts(2339): [0mProperty 'push' does not exist on type '{}'.

[7m749[0m     userAuditTrail.push(auditLog.id)
[7m   [0m [91m                   ~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m719[0m:[93m7[0m - [91merror[0m[90m ts(2322): [0mType '"system"' is not assignable to type 'UserRole'.

[7m719[0m       actorRole: 'system',
[7m   [0m [91m      ~~~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m717[0m:[93m23[0m - [91merror[0m[90m ts(2339): [0mProperty 'requestedRole' does not exist on type '{}'.

[7m717[0m       roleTo: request.requestedRole,
[7m   [0m [91m                      ~~~~~~~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m716[0m:[93m25[0m - [91merror[0m[90m ts(2339): [0mProperty 'currentRole' does not exist on type '{}'.

[7m716[0m       roleFrom: request.currentRole,
[7m   [0m [91m                        ~~~~~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m714[0m:[93m23[0m - [91merror[0m[90m ts(2339): [0mProperty 'userId' does not exist on type '{}'.

[7m714[0m       userId: request.userId,
[7m   [0m [91m                      ~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m708[0m:[93m44[0m - [91merror[0m[90m ts(2339): [0mProperty 'userId' does not exist on type '{}'.

[7m708[0m     await removeUserPendingRequest(request.userId, requestId)
[7m   [0m [91m                                           ~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m704[0m:[93m27[0m - [91merror[0m[90m ts(2339): [0mProperty 'expiresAt' does not exist on type '{}'.

[7m704[0m       Math.floor((request.expiresAt - Date.now()) / 1000),
[7m   [0m [91m                          ~~~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m699[0m:[93m13[0m - [91merror[0m[90m ts(2339): [0mProperty 'status' does not exist on type '{}'.

[7m699[0m     request.status = 'expired'
[7m   [0m [91m            ~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m680[0m:[93m23[0m - [91merror[0m[90m ts(2345): [0mArgument of type '{}' is not assignable to parameter of type 'RoleTransitionRequest'.
  Type '{}' is missing the following properties from type 'RoleTransitionRequest': id, userId, currentRole, requestedRole, and 7 more.

[7m680[0m         requests.push(request)
[7m   [0m [91m                      ~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m679[0m:[93m30[0m - [91merror[0m[90m ts(2339): [0mProperty 'status' does not exist on type '{}'.

[7m679[0m       if (request && request.status === 'pending') {
[7m   [0m [91m                             ~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m677[0m:[93m29[0m - [91merror[0m[90m ts(2488): [0mType '{}' must have a '[Symbol.iterator]()' method that returns an iterator.

[7m677[0m     for (const requestId of requestIds) {
[7m   [0m [91m                            ~~~~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m655[0m:[93m25[0m - [91merror[0m[90m ts(2339): [0mProperty 'length' does not exist on type '{}'.

[7m655[0m     if (pendingRequests.length > 0) {
[7m   [0m [91m                        ~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m653[0m:[93m39[0m - [91merror[0m[90m ts(2339): [0mProperty 'filter' does not exist on type '{}'.

[7m653[0m     pendingRequests = pendingRequests.filter((id: string) => id !== requestId)
[7m   [0m [91m                                      ~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m634[0m:[93m21[0m - [91merror[0m[90m ts(2339): [0mProperty 'push' does not exist on type '{}'.

[7m634[0m     pendingRequests.push(requestId)
[7m   [0m [91m                    ~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m576[0m:[93m31[0m - [91merror[0m[90m ts(2345): [0mArgument of type '{}' is not assignable to parameter of type 'RoleTransitionRequest'.
  Type '{}' is missing the following properties from type 'RoleTransitionRequest': id, userId, currentRole, requestedRole, and 7 more.

[7m576[0m         eligibleRequests.push(request)
[7m   [0m [91m                              ~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m574[0m:[93m56[0m - [91merror[0m[90m ts(2339): [0mProperty 'requestedRole' does not exist on type '{}'.

[7m574[0m         canApproveRoleTransition(approverRole, request.requestedRole)
[7m   [0m [91m                                                       ~~~~~~~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m573[0m:[93m31[0m - [91merror[0m[90m ts(2339): [0mProperty 'expiresAt' does not exist on type '{}'.

[7m573[0m         Date.now() <= request.expiresAt &&
[7m   [0m [91m                              ~~~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m572[0m:[93m17[0m - [91merror[0m[90m ts(2339): [0mProperty 'status' does not exist on type '{}'.

[7m572[0m         request.status === 'pending' &&
[7m   [0m [91m                ~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m568[0m:[93m29[0m - [91merror[0m[90m ts(2488): [0mType '{}' must have a '[Symbol.iterator]()' method that returns an iterator.

[7m568[0m     for (const requestId of requestIds) {
[7m   [0m [91m                            ~~~~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m541[0m:[93m23[0m - [91merror[0m[90m ts(2345): [0mArgument of type '{}' is not assignable to parameter of type 'RoleTransitionRequest'.
  Type '{}' is missing the following properties from type 'RoleTransitionRequest': id, userId, currentRole, requestedRole, and 7 more.

[7m541[0m         requests.push(request)
[7m   [0m [91m                      ~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m540[0m:[93m42[0m - [91merror[0m[90m ts(2339): [0mProperty 'status' does not exist on type '{}'.

[7m540[0m       if (request && (!status || request.status === status)) {
[7m   [0m [91m                                         ~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m538[0m:[93m29[0m - [91merror[0m[90m ts(2488): [0mType '{}' must have a '[Symbol.iterator]()' method that returns an iterator.

[7m538[0m     for (const requestId of requestIds) {
[7m   [0m [91m                            ~~~~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m513[0m:[93m7[0m - [91merror[0m[90m ts(2554): [0mExpected 2 arguments, but got 3.

[7m513[0m       {
[7m   [0m [91m      ~[0m
[7m514[0m         error: error instanceof Error ? error.message : 'Unknown error',
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m515[0m         requestId,
[7m   [0m [91m~~~~~~~~~~~~~~~~~~[0m
[7m516[0m       },
[7m   [0m [91m~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m511[0m:[93m7[0m - [91merror[0m[90m ts(2693): [0m'SecurityEventType' only refers to a type, but is being used as a value here.

[7m511[0m       SecurityEventType.ROLE_TRANSITION_CANCELLATION_FAILED,
[7m   [0m [91m      ~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m506[0m:[93m15[0m - [91merror[0m[90m ts(2339): [0mProperty 'userId' does not exist on type '{}'.

[7m506[0m       request.userId,
[7m   [0m [91m              ~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m502[0m:[93m44[0m - [91merror[0m[90m ts(2345): [0mArgument of type '{}' is not assignable to parameter of type 'RoleTransitionRequest'.
  Type '{}' is missing the following properties from type 'RoleTransitionRequest': id, userId, currentRole, requestedRole, and 7 more.

[7m502[0m     await notifyRoleTransitionCancellation(request, userId, reason)
[7m   [0m [91m                                           ~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m491[0m:[93m23[0m - [91merror[0m[90m ts(2339): [0mProperty 'requestedRole' does not exist on type '{}'.

[7m491[0m       roleTo: request.requestedRole,
[7m   [0m [91m                      ~~~~~~~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m490[0m:[93m25[0m - [91merror[0m[90m ts(2339): [0mProperty 'currentRole' does not exist on type '{}'.

[7m490[0m       roleFrom: request.currentRole,
[7m   [0m [91m                        ~~~~~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m488[0m:[93m23[0m - [91merror[0m[90m ts(2339): [0mProperty 'userId' does not exist on type '{}'.

[7m488[0m       userId: request.userId,
[7m   [0m [91m                      ~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m482[0m:[93m44[0m - [91merror[0m[90m ts(2339): [0mProperty 'userId' does not exist on type '{}'.

[7m482[0m     await removeUserPendingRequest(request.userId, requestId)
[7m   [0m [91m                                           ~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m478[0m:[93m27[0m - [91merror[0m[90m ts(2339): [0mProperty 'expiresAt' does not exist on type '{}'.

[7m478[0m       Math.floor((request.expiresAt - Date.now()) / 1000),
[7m   [0m [91m                          ~~~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m472[0m:[93m13[0m - [91merror[0m[90m ts(2339): [0mProperty 'cancellationReason' does not exist on type '{}'.

[7m472[0m     request.cancellationReason = reason
[7m   [0m [91m            ~~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m471[0m:[93m13[0m - [91merror[0m[90m ts(2339): [0mProperty 'cancelledAt' does not exist on type '{}'.

[7m471[0m     request.cancelledAt = Date.now()
[7m   [0m [91m            ~~~~~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m470[0m:[93m13[0m - [91merror[0m[90m ts(2339): [0mProperty 'status' does not exist on type '{}'.

[7m470[0m     request.status = 'cancelled'
[7m   [0m [91m            ~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m463[0m:[93m17[0m - [91merror[0m[90m ts(2339): [0mProperty 'status' does not exist on type '{}'.

[7m463[0m     if (request.status !== 'pending') {
[7m   [0m [91m                ~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m456[0m:[93m46[0m - [91merror[0m[90m ts(2339): [0mProperty 'requestedBy' does not exist on type '{}'.

[7m456[0m     if (request.userId !== userId && request.requestedBy !== userId) {
[7m   [0m [91m                                             ~~~~~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m456[0m:[93m17[0m - [91merror[0m[90m ts(2339): [0mProperty 'userId' does not exist on type '{}'.

[7m456[0m     if (request.userId !== userId && request.requestedBy !== userId) {
[7m   [0m [91m                ~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m425[0m:[93m7[0m - [91merror[0m[90m ts(2554): [0mExpected 2 arguments, but got 3.

[7m425[0m       {
[7m   [0m [91m      ~[0m
[7m426[0m         error: error instanceof Error ? error.message : 'Unknown error',
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m427[0m         requestId: request.id,
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m428[0m       },
[7m   [0m [91m~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m423[0m:[93m7[0m - [91merror[0m[90m ts(2693): [0m'SecurityEventType' only refers to a type, but is being used as a value here.

[7m423[0m       SecurityEventType.ROLE_TRANSITION_EXECUTION_FAILED,
[7m   [0m [91m      ~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m394[0m:[93m14[0m - [91merror[0m[90m ts(2339): [0mProperty 'permissions' does not exist on type '{}'.

[7m394[0m     userAuth.permissions = newPermissions
[7m   [0m [91m             ~~~~~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m383[0m:[93m14[0m - [91merror[0m[90m ts(2339): [0mProperty 'updatedAt' does not exist on type '{}'.

[7m383[0m     userAuth.updatedAt = Date.now()
[7m   [0m [91m             ~~~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m382[0m:[93m14[0m - [91merror[0m[90m ts(2339): [0mProperty 'role' does not exist on type '{}'.

[7m382[0m     userAuth.role = request.requestedRole
[7m   [0m [91m             ~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m381[0m:[93m35[0m - [91merror[0m[90m ts(2339): [0mProperty 'role' does not exist on type '{}'.

[7m381[0m     const previousRole = userAuth.role
[7m   [0m [91m                                  ~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m356[0m:[93m9[0m - [91merror[0m[90m ts(18004): [0mNo value exists in scope for the shorthand property 'decision'. Either declare one or provide an initializer.

[7m356[0m         decision,
[7m   [0m [91m        ~~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m355[0m:[93m9[0m - [91merror[0m[90m ts(18004): [0mNo value exists in scope for the shorthand property 'requestId'. Either declare one or provide an initializer.

[7m355[0m         requestId,
[7m   [0m [91m        ~~~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m353[0m:[93m7[0m - [91merror[0m[90m ts(2554): [0mExpected 2 arguments, but got 3.

[7m353[0m       {
[7m   [0m [91m      ~[0m
[7m354[0m         error: error instanceof Error ? error.message : 'Unknown error',
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m...[0m 
[7m356[0m         decision,
[7m   [0m [91m~~~~~~~~~~~~~~~~~[0m
[7m357[0m       },
[7m   [0m [91m~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m352[0m:[93m7[0m - [91merror[0m[90m ts(2304): [0mCannot find name 'approverId'.

[7m352[0m       approverId,
[7m   [0m [91m      ~~~~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m351[0m:[93m7[0m - [91merror[0m[90m ts(2693): [0m'SecurityEventType' only refers to a type, but is being used as a value here.

[7m351[0m       SecurityEventType.ROLE_TRANSITION_APPROVAL_FAILED,
[7m   [0m [91m      ~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m348[0m:[93m5[0m - [91merror[0m[90m ts(2740): [0mType '{}' is missing the following properties from type 'RoleTransitionRequest': id, userId, currentRole, requestedRole, and 7 more.

[7m348[0m     return request
[7m   [0m [91m    ~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m344[0m:[93m15[0m - [91merror[0m[90m ts(2339): [0mProperty 'userId' does not exist on type '{}'.

[7m344[0m       request.userId,
[7m   [0m [91m              ~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m340[0m:[93m40[0m - [91merror[0m[90m ts(2345): [0mArgument of type '{}' is not assignable to parameter of type 'RoleTransitionRequest'.
  Type '{}' is missing the following properties from type 'RoleTransitionRequest': id, userId, currentRole, requestedRole, and 7 more.

[7m340[0m     await notifyRoleTransitionDecision(request, approverId, decision)
[7m   [0m [91m                                       ~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m337[0m:[93m44[0m - [91merror[0m[90m ts(2339): [0mProperty 'userId' does not exist on type '{}'.

[7m337[0m     await removeUserPendingRequest(request.userId, requestId)
[7m   [0m [91m                                           ~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m333[0m:[93m35[0m - [91merror[0m[90m ts(2345): [0mArgument of type '{}' is not assignable to parameter of type 'RoleTransitionRequest'.
  Type '{}' is missing the following properties from type 'RoleTransitionRequest': id, userId, currentRole, requestedRole, and 7 more.

[7m333[0m       await executeRoleTransition(request, approverSession)
[7m   [0m [91m                                  ~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m321[0m:[93m23[0m - [91merror[0m[90m ts(2339): [0mProperty 'requestedRole' does not exist on type '{}'.

[7m321[0m       roleTo: request.requestedRole,
[7m   [0m [91m                      ~~~~~~~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m320[0m:[93m25[0m - [91merror[0m[90m ts(2339): [0mProperty 'currentRole' does not exist on type '{}'.

[7m320[0m       roleFrom: request.currentRole,
[7m   [0m [91m                        ~~~~~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m318[0m:[93m23[0m - [91merror[0m[90m ts(2339): [0mProperty 'userId' does not exist on type '{}'.

[7m318[0m       userId: request.userId,
[7m   [0m [91m                      ~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m311[0m:[93m27[0m - [91merror[0m[90m ts(2339): [0mProperty 'expiresAt' does not exist on type '{}'.

[7m311[0m       Math.floor((request.expiresAt - now) / 1000),
[7m   [0m [91m                          ~~~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m305[0m:[93m13[0m - [91merror[0m[90m ts(2339): [0mProperty 'rejectionReason' does not exist on type '{}'.

[7m305[0m     request.rejectionReason = decision === 'reject' ? reason : undefined
[7m   [0m [91m            ~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m304[0m:[93m13[0m - [91merror[0m[90m ts(2339): [0mProperty 'rejectedAt' does not exist on type '{}'.

[7m304[0m     request.rejectedAt = decision === 'reject' ? now : undefined
[7m   [0m [91m            ~~~~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m303[0m:[93m13[0m - [91merror[0m[90m ts(2339): [0mProperty 'approvedAt' does not exist on type '{}'.

[7m303[0m     request.approvedAt = decision === 'approve' ? now : undefined
[7m   [0m [91m            ~~~~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m302[0m:[93m13[0m - [91merror[0m[90m ts(2339): [0mProperty 'approvalReason' does not exist on type '{}'.

[7m302[0m     request.approvalReason = reason
[7m   [0m [91m            ~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m301[0m:[93m13[0m - [91merror[0m[90m ts(2339): [0mProperty 'approverId' does not exist on type '{}'.

[7m301[0m     request.approverId = approverId
[7m   [0m [91m            ~~~~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m300[0m:[93m13[0m - [91merror[0m[90m ts(2339): [0mProperty 'status' does not exist on type '{}'.

[7m300[0m     request.status = decision === 'approve' ? 'approved' : 'rejected'
[7m   [0m [91m            ~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m272[0m:[93m57[0m - [91merror[0m[90m ts(2339): [0mProperty 'requestedRole' does not exist on type '{}'.

[7m272[0m     if (!canApproveRoleTransition(approverRole, request.requestedRole)) {
[7m   [0m [91m                                                        ~~~~~~~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m266[0m:[93m30[0m - [91merror[0m[90m ts(2339): [0mProperty 'expiresAt' does not exist on type '{}'.

[7m266[0m     if (Date.now() > request.expiresAt) {
[7m   [0m [91m                             ~~~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m259[0m:[93m17[0m - [91merror[0m[90m ts(2339): [0mProperty 'status' does not exist on type '{}'.

[7m259[0m     if (request.status !== 'pending') {
[7m   [0m [91m                ~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m218[0m:[93m7[0m - [91merror[0m[90m ts(2554): [0mExpected 2 arguments, but got 3.

[7m218[0m       {
[7m   [0m [91m      ~[0m
[7m219[0m         error: error instanceof Error ? error.message : 'Unknown error',
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m...[0m 
[7m221[0m         requestedBy,
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~[0m
[7m222[0m       },
[7m   [0m [91m~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m216[0m:[93m7[0m - [91merror[0m[90m ts(2693): [0m'SecurityEventType' only refers to a type, but is being used as a value here.

[7m216[0m       SecurityEventType.ROLE_TRANSITION_REQUEST_FAILED,
[7m   [0m [91m      ~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m812[0m:[93m3[0m - [93mwarning[0m[90m ts(6133): [0m'reason' is declared but its value is never read.

[7m812[0m   reason: string,
[7m   [0m [93m  ~~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m763[0m:[93m5[0m - [93mwarning[0m[90m ts(80007): [0m'await' has no effect on the type of this expression.

[7m763[0m     await logSecurityEvent(
[7m   [0m [93m    ~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m764[0m       SecurityEventType.ROLE_TRANSITION_AUDIT,
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m...[0m 
[7m772[0m       },
[7m   [0m [93m~~~~~~~~[0m
[7m773[0m     )
[7m   [0m [93m~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m510[0m:[93m5[0m - [93mwarning[0m[90m ts(80007): [0m'await' has no effect on the type of this expression.

[7m510[0m     await logSecurityEvent(
[7m   [0m [93m    ~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m511[0m       SecurityEventType.ROLE_TRANSITION_CANCELLATION_FAILED,
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m...[0m 
[7m516[0m       },
[7m   [0m [93m~~~~~~~~[0m
[7m517[0m     )
[7m   [0m [93m~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m422[0m:[93m5[0m - [93mwarning[0m[90m ts(80007): [0m'await' has no effect on the type of this expression.

[7m422[0m     await logSecurityEvent(
[7m   [0m [93m    ~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m423[0m       SecurityEventType.ROLE_TRANSITION_EXECUTION_FAILED,
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m...[0m 
[7m428[0m       },
[7m   [0m [93m~~~~~~~~[0m
[7m429[0m     )
[7m   [0m [93m~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m350[0m:[93m5[0m - [93mwarning[0m[90m ts(80007): [0m'await' has no effect on the type of this expression.

[7m350[0m     await logSecurityEvent(
[7m   [0m [93m    ~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m351[0m       SecurityEventType.ROLE_TRANSITION_APPROVAL_FAILED,
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m...[0m 
[7m357[0m       },
[7m   [0m [93m~~~~~~~~[0m
[7m358[0m     )
[7m   [0m [93m~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m215[0m:[93m5[0m - [93mwarning[0m[90m ts(80007): [0m'await' has no effect on the type of this expression.

[7m215[0m     await logSecurityEvent(
[7m   [0m [93m    ~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m216[0m       SecurityEventType.ROLE_TRANSITION_REQUEST_FAILED,
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m...[0m 
[7m222[0m       },
[7m   [0m [93m~~~~~~~~[0m
[7m223[0m     )
[7m   [0m [93m~~~~~[0m
[96msrc/lib/auth/role-transitions.ts[0m:[93m8[0m:[93m28[0m - [93mwarning[0m[90m ts(6133): [0m'SecurityEventType' is declared but its value is never read.

[7m8[0m import { logSecurityEvent, SecurityEventType } from '../security'
[7m [0m [93m                           ~~~~~~~~~~~~~~~~~[0m

[96msrc/lib/auth/security-event-logger.ts[0m:[93m624[0m:[93m35[0m - [91merror[0m[90m ts(2339): [0mProperty 'pipeline' does not exist on type 'RedisClientType'.

[7m624[0m       const pipeline = this.redis.pipeline()
[7m   [0m [91m                                  ~~~~~~~~[0m
[96msrc/lib/auth/security-event-logger.ts[0m:[93m543[0m:[93m35[0m - [91merror[0m[90m ts(2339): [0mProperty 'pipeline' does not exist on type 'RedisClientType'.

[7m543[0m       const pipeline = this.redis.pipeline()
[7m   [0m [91m                                  ~~~~~~~~[0m
[96msrc/lib/auth/security-event-logger.ts[0m:[93m529[0m:[93m41[0m - [91merror[0m[90m ts(2551): [0mProperty 'zrangebyscore' does not exist on type 'RedisClientType'. Did you mean 'zRangeByScore'?

[7m529[0m       const eventIds = await this.redis.zrangebyscore(
[7m   [0m [91m                                        ~~~~~~~~~~~~~[0m
[96msrc/lib/auth/security-event-logger.ts[0m:[93m10[0m:[93m10[0m - [91merror[0m[90m ts(2305): [0mModule '"../redis"' has no exported member 'getRedisClient'.

[7m10[0m import { getRedisClient } from '../redis'
[7m  [0m [91m         ~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/security-event-logger.ts[0m:[93m922[0m:[93m26[0m - [93mwarning[0m[90m ts(6133): [0m'token' is declared but its value is never read.

[7m922[0m   private extractTokenId(token: string): string {
[7m   [0m [93m                         ~~~~~[0m
[96msrc/lib/auth/security-event-logger.ts[0m:[93m917[0m:[93m28[0m - [93mwarning[0m[90m ts(6133): [0m'data' is declared but its value is never read.

[7m917[0m   private deserializeEvent(data: Record<string, string>): SecurityEvent {
[7m   [0m [93m                           ~~~~[0m
[96msrc/lib/auth/security-event-logger.ts[0m:[93m912[0m:[93m26[0m - [93mwarning[0m[90m ts(6133): [0m'event' is declared but its value is never read.

[7m912[0m   private serializeEvent(event: SecurityEvent): Record<string, string> {
[7m   [0m [93m                         ~~~~~[0m
[96msrc/lib/auth/security-event-logger.ts[0m:[93m907[0m:[93m38[0m - [93mwarning[0m[90m ts(6133): [0m'events' is declared but its value is never read.

[7m907[0m   private calculateMetricsFromEvents(events: SecurityEvent[]): SecurityMetrics {
[7m   [0m [93m                                     ~~~~~~[0m
[96msrc/lib/auth/security-event-logger.ts[0m:[93m901[0m:[93m5[0m - [93mwarning[0m[90m ts(6133): [0m'violations' is declared but its value is never read.

[7m901[0m     violations: string[],
[7m   [0m [93m    ~~~~~~~~~~[0m
[96msrc/lib/auth/security-event-logger.ts[0m:[93m900[0m:[93m5[0m - [93mwarning[0m[90m ts(6133): [0m'events' is declared but its value is never read.

[7m900[0m     events: SecurityEvent[],
[7m   [0m [93m    ~~~~~~[0m
[96msrc/lib/auth/security-event-logger.ts[0m:[93m886[0m:[93m39[0m - [93mwarning[0m[90m ts(6133): [0m'events' is declared but its value is never read.

[7m886[0m   private async checkComplianceStatus(events: SecurityEvent[]): Promise<{
[7m   [0m [93m                                      ~~~~~~[0m
[96msrc/lib/auth/security-event-logger.ts[0m:[93m880[0m:[93m5[0m - [93mwarning[0m[90m ts(6133): [0m'endDate' is declared but its value is never read.

[7m880[0m     endDate: Date,
[7m   [0m [93m    ~~~~~~~[0m
[96msrc/lib/auth/security-event-logger.ts[0m:[93m879[0m:[93m5[0m - [93mwarning[0m[90m ts(6133): [0m'startDate' is declared but its value is never read.

[7m879[0m     startDate: Date,
[7m   [0m [93m    ~~~~~~~~~[0m

[96msrc/lib/auth/serverAuth.ts[0m:[93m262[0m:[93m27[0m - [91merror[0m[90m ts(2345): [0mArgument of type '{ request: Request; requestIp: string; requiredRole: AuthRole; validateIPMatch: boolean; validateUserAgent: boolean; }' is not assignable to parameter of type 'ServerAuthOptions'.
  Property 'cookies' is missing in type '{ request: Request; requestIp: string; requiredRole: AuthRole; validateIPMatch: boolean; validateUserAgent: boolean; }' but required in type 'ServerAuthOptions'.

[7m262[0m   return verifyServerAuth({
[7m   [0m [91m                          ~[0m
[7m263[0m     request,
[7m   [0m [91m~~~~~~~~~~~~[0m
[7m...[0m 
[7m267[0m     validateUserAgent,
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~[0m
[7m268[0m   })
[7m   [0m [91m~~~[0m

[96msrc/lib/auth/session-management.ts[0m:[93m608[0m:[93m39[0m - [91merror[0m[90m ts(2339): [0mProperty 'userId' does not exist on type '{}'.

[7m608[0m         affectedUsers.add(sessionData.userId)
[7m   [0m [91m                                      ~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m606[0m:[93m42[0m - [91merror[0m[90m ts(2339): [0mProperty 'sessionId' does not exist on type '{}'.

[7m606[0m         await destroySession(sessionData.sessionId, 'expired_cleanup')
[7m   [0m [91m                                         ~~~~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m605[0m:[93m51[0m - [91merror[0m[90m ts(2339): [0mProperty 'expiresAt' does not exist on type '{}'.

[7m605[0m       if (sessionData && Date.now() > sessionData.expiresAt) {
[7m   [0m [91m                                                  ~~~~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m576[0m:[93m37[0m - [91merror[0m[90m ts(2339): [0mProperty 'find' does not exist on type '{}'.

[7m576[0m     const sessionInfo = sessionList.find((s: any) => s.sessionId === sessionId)
[7m   [0m [91m                                    ~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m554[0m:[93m21[0m - [91merror[0m[90m ts(2339): [0mProperty 'length' does not exist on type '{}'.

[7m554[0m     if (sessionList.length > 0) {
[7m   [0m [91m                    ~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m552[0m:[93m31[0m - [91merror[0m[90m ts(2339): [0mProperty 'filter' does not exist on type '{}'.

[7m552[0m     sessionList = sessionList.filter((s: any) => s.sessionId !== sessionId)
[7m   [0m [91m                              ~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m528[0m:[93m17[0m - [91merror[0m[90m ts(2339): [0mProperty 'push' does not exist on type '{}'.

[7m528[0m     sessionList.push({
[7m   [0m [91m                ~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m504[0m:[93m21[0m - [91merror[0m[90m ts(2339): [0mProperty 'length' does not exist on type '{}'.

[7m504[0m         sessionList.length - SESSION_CONFIG.concurrentSessionLimit + 1,
[7m   [0m [91m                    ~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m502[0m:[93m44[0m - [91merror[0m[90m ts(2339): [0mProperty 'slice' does not exist on type '{}'.

[7m502[0m       const sessionsToRemove = sessionList.slice(
[7m   [0m [91m                                           ~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m499[0m:[93m19[0m - [91merror[0m[90m ts(2339): [0mProperty 'sort' does not exist on type '{}'.

[7m499[0m       sessionList.sort((a: any, b: any) => a.lastActivity - b.lastActivity)
[7m   [0m [91m                  ~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m497[0m:[93m21[0m - [91merror[0m[90m ts(2339): [0mProperty 'length' does not exist on type '{}'.

[7m497[0m     if (sessionList.length >= SESSION_CONFIG.concurrentSessionLimit) {
[7m   [0m [91m                    ~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m479[0m:[93m33[0m - [91merror[0m[90m ts(2339): [0mProperty 'length' does not exist on type '{}'.

[7m479[0m       sessionCount: sessionList.length,
[7m   [0m [91m                                ~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m477[0m:[93m78[0m - [91merror[0m[90m ts(2554): [0mExpected 2 arguments, but got 3.

[7m477[0m     await logSecurityEvent(SecurityEventType.ALL_SESSIONS_DESTROYED, userId, {
[7m   [0m [91m                                                                             ~[0m
[7m478[0m       reason,
[7m   [0m [91m~~~~~~~~~~~~~[0m
[7m479[0m       sessionCount: sessionList.length,
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m480[0m     })
[7m   [0m [91m~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m477[0m:[93m28[0m - [91merror[0m[90m ts(2693): [0m'SecurityEventType' only refers to a type, but is being used as a value here.

[7m477[0m     await logSecurityEvent(SecurityEventType.ALL_SESSIONS_DESTROYED, userId, {
[7m   [0m [91m                           ~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m472[0m:[93m31[0m - [91merror[0m[90m ts(2488): [0mType '{}' must have a '[Symbol.iterator]()' method that returns an iterator.

[7m472[0m     for (const sessionInfo of sessionList) {
[7m   [0m [91m                              ~~~~~~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m448[0m:[93m37[0m - [91merror[0m[90m ts(2339): [0mProperty 'lastActivity' does not exist on type '{}'.

[7m448[0m           lastActivity: sessionData.lastActivity,
[7m   [0m [91m                                    ~~~~~~~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m447[0m:[93m34[0m - [91merror[0m[90m ts(2339): [0mProperty 'ipAddress' does not exist on type '{}'.

[7m447[0m           ipAddress: sessionData.ipAddress,
[7m   [0m [91m                                 ~~~~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m446[0m:[93m35[0m - [91merror[0m[90m ts(2339): [0mProperty 'deviceInfo' does not exist on type '{}'.

[7m446[0m           deviceType: sessionData.deviceInfo.deviceType,
[7m   [0m [91m                                  ~~~~~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m445[0m:[93m35[0m - [91merror[0m[90m ts(2339): [0mProperty 'deviceInfo' does not exist on type '{}'.

[7m445[0m           deviceName: sessionData.deviceInfo.deviceName,
[7m   [0m [91m                                  ~~~~~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m444[0m:[93m34[0m - [91merror[0m[90m ts(2339): [0mProperty 'sessionId' does not exist on type '{}'.

[7m444[0m           sessionId: sessionData.sessionId,
[7m   [0m [91m                                 ~~~~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m442[0m:[93m51[0m - [91merror[0m[90m ts(2339): [0mProperty 'expiresAt' does not exist on type '{}'.

[7m442[0m       if (sessionData && Date.now() < sessionData.expiresAt) {
[7m   [0m [91m                                                  ~~~~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m440[0m:[93m31[0m - [91merror[0m[90m ts(2488): [0mType '{}' must have a '[Symbol.iterator]()' method that returns an iterator.

[7m440[0m     for (const sessionInfo of sessionList) {
[7m   [0m [91m                              ~~~~~~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m420[0m:[93m19[0m - [91merror[0m[90m ts(2339): [0mProperty 'userId' does not exist on type '{}'.

[7m420[0m       sessionData.userId,
[7m   [0m [91m                  ~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m414[0m:[93m31[0m - [91merror[0m[90m ts(2339): [0mProperty 'deviceId' does not exist on type '{}'.

[7m414[0m         deviceId: sessionData.deviceId,
[7m   [0m [91m                              ~~~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m411[0m:[93m7[0m - [91merror[0m[90m ts(2554): [0mExpected 2 arguments, but got 3.

[7m411[0m       {
[7m   [0m [91m      ~[0m
[7m412[0m         sessionId,
[7m   [0m [91m~~~~~~~~~~~~~~~~~~[0m
[7m...[0m 
[7m414[0m         deviceId: sessionData.deviceId,
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m415[0m       },
[7m   [0m [91m~~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m410[0m:[93m19[0m - [91merror[0m[90m ts(2339): [0mProperty 'userId' does not exist on type '{}'.

[7m410[0m       sessionData.userId,
[7m   [0m [91m                  ~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m409[0m:[93m7[0m - [91merror[0m[90m ts(2693): [0m'SecurityEventType' only refers to a type, but is being used as a value here.

[7m409[0m       SecurityEventType.SESSION_DESTROYED,
[7m   [0m [91m      ~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m405[0m:[93m41[0m - [91merror[0m[90m ts(2339): [0mProperty 'userId' does not exist on type '{}'.

[7m405[0m     await removeUserSession(sessionData.userId, sessionId)
[7m   [0m [91m                                        ~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m380[0m:[93m5[0m - [91merror[0m[90m ts(2740): [0mType '{}' is missing the following properties from type 'SessionData': sessionId, userId, role, deviceId, and 10 more.

[7m380[0m     return sessionData
[7m   [0m [91m    ~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m376[0m:[93m32[0m - [91merror[0m[90m ts(2339): [0mProperty 'expiresAt' does not exist on type '{}'.

[7m376[0m         newExpiry: sessionData.expiresAt,
[7m   [0m [91m                               ~~~~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m374[0m:[93m7[0m - [91merror[0m[90m ts(2554): [0mExpected 2 arguments, but got 3.

[7m374[0m       {
[7m   [0m [91m      ~[0m
[7m375[0m         sessionId,
[7m   [0m [91m~~~~~~~~~~~~~~~~~~[0m
[7m376[0m         newExpiry: sessionData.expiresAt,
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m377[0m       },
[7m   [0m [91m~~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m373[0m:[93m19[0m - [91merror[0m[90m ts(2339): [0mProperty 'userId' does not exist on type '{}'.

[7m373[0m       sessionData.userId,
[7m   [0m [91m                  ~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m372[0m:[93m7[0m - [91merror[0m[90m ts(2693): [0m'SecurityEventType' only refers to a type, but is being used as a value here.

[7m372[0m       SecurityEventType.SESSION_REFRESHED,
[7m   [0m [91m      ~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m367[0m:[93m19[0m - [91merror[0m[90m ts(2339): [0mProperty 'expiresAt' does not exist on type '{}'.

[7m367[0m       sessionData.expiresAt,
[7m   [0m [91m                  ~~~~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m365[0m:[93m19[0m - [91merror[0m[90m ts(2339): [0mProperty 'userId' does not exist on type '{}'.

[7m365[0m       sessionData.userId,
[7m   [0m [91m                  ~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m354[0m:[93m17[0m - [91merror[0m[90m ts(2339): [0mProperty 'lastActivity' does not exist on type '{}'.

[7m354[0m     sessionData.lastActivity = Date.now()
[7m   [0m [91m                ~~~~~~~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m353[0m:[93m17[0m - [91merror[0m[90m ts(2339): [0mProperty 'expiresAt' does not exist on type '{}'.

[7m353[0m     sessionData.expiresAt = Date.now() + extendByMs
[7m   [0m [91m                ~~~~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m328[0m:[93m7[0m - [91merror[0m[90m ts(2740): [0mType '{}' is missing the following properties from type 'SessionData': sessionId, userId, role, deviceId, and 10 more.

[7m328[0m       session: sessionData,
[7m   [0m [91m      ~~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m320[0m:[93m7[0m - [91merror[0m[90m ts(2554): [0mExpected 2 arguments, but got 3.

[7m320[0m       {
[7m   [0m [91m      ~[0m
[7m321[0m         sessionId,
[7m   [0m [91m~~~~~~~~~~~~~~~~~~[0m
[7m322[0m         deviceId: deviceInfo.deviceId,
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m323[0m       },
[7m   [0m [91m~~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m319[0m:[93m19[0m - [91merror[0m[90m ts(2339): [0mProperty 'userId' does not exist on type '{}'.

[7m319[0m       sessionData.userId,
[7m   [0m [91m                  ~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m318[0m:[93m7[0m - [91merror[0m[90m ts(2693): [0m'SecurityEventType' only refers to a type, but is being used as a value here.

[7m318[0m       SecurityEventType.SESSION_VALIDATED,
[7m   [0m [91m      ~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m313[0m:[93m31[0m - [91merror[0m[90m ts(2339): [0mProperty 'expiresAt' does not exist on type '{}'.

[7m313[0m       Math.floor((sessionData.expiresAt - Date.now()) / 1000),
[7m   [0m [91m                              ~~~~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m309[0m:[93m17[0m - [91merror[0m[90m ts(2339): [0mProperty 'lastActivity' does not exist on type '{}'.

[7m309[0m     sessionData.lastActivity = Date.now()
[7m   [0m [91m                ~~~~~~~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m295[0m:[93m35[0m - [91merror[0m[90m ts(2339): [0mProperty 'ipAddress' does not exist on type '{}'.

[7m295[0m           expectedIp: sessionData.ipAddress,
[7m   [0m [91m                                  ~~~~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m292[0m:[93m9[0m - [91merror[0m[90m ts(2554): [0mExpected 2 arguments, but got 3.

[7m292[0m         {
[7m   [0m [91m        ~[0m
[7m293[0m           sessionId,
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~[0m
[7m...[0m 
[7m296[0m           actualIp: ipAddress,
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m297[0m         },
[7m   [0m [91m~~~~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m291[0m:[93m21[0m - [91merror[0m[90m ts(2339): [0mProperty 'userId' does not exist on type '{}'.

[7m291[0m         sessionData.userId,
[7m   [0m [91m                    ~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m290[0m:[93m9[0m - [91merror[0m[90m ts(2693): [0m'SecurityEventType' only refers to a type, but is being used as a value here.

[7m290[0m         SecurityEventType.SESSION_SECURITY_ALERT,
[7m   [0m [91m        ~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m287[0m:[93m19[0m - [91merror[0m[90m ts(2339): [0mProperty 'ipAddress' does not exist on type '{}'.

[7m287[0m       sessionData.ipAddress !== ipAddress
[7m   [0m [91m                  ~~~~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m270[0m:[93m42[0m - [91merror[0m[90m ts(2339): [0mProperty 'fingerprint' does not exist on type '{}'.

[7m270[0m               expectedDevice: deviceData.fingerprint,
[7m   [0m [91m                                         ~~~~~~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m267[0m:[93m13[0m - [91merror[0m[90m ts(2554): [0mExpected 2 arguments, but got 3.

[7m267[0m             {
[7m   [0m [91m            ~[0m
[7m268[0m               sessionId,
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m...[0m 
[7m271[0m               actualDevice: currentFingerprint,
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m272[0m             },
[7m   [0m [91m~~~~~~~~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m266[0m:[93m25[0m - [91merror[0m[90m ts(2339): [0mProperty 'userId' does not exist on type '{}'.

[7m266[0m             sessionData.userId,
[7m   [0m [91m                        ~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m265[0m:[93m13[0m - [91merror[0m[90m ts(2693): [0m'SecurityEventType' only refers to a type, but is being used as a value here.

[7m265[0m             SecurityEventType.SESSION_SECURITY_ALERT,
[7m   [0m [91m            ~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m263[0m:[93m24[0m - [91merror[0m[90m ts(2339): [0mProperty 'fingerprint' does not exist on type '{}'.

[7m263[0m         if (deviceData.fingerprint !== currentFingerprint) {
[7m   [0m [91m                       ~~~~~~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m247[0m:[93m34[0m - [91merror[0m[90m ts(2339): [0mProperty 'expiresAt' does not exist on type '{}'.

[7m247[0m     if (Date.now() > sessionData.expiresAt) {
[7m   [0m [91m                                 ~~~~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m215[0m:[93m7[0m - [91merror[0m[90m ts(2554): [0mExpected 2 arguments, but got 3.

[7m215[0m       {
[7m   [0m [91m      ~[0m
[7m216[0m         error: error instanceof Error ? error.message : 'Unknown error',
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m217[0m         deviceId: options.deviceInfo.deviceId,
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m218[0m       },
[7m   [0m [91m~~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m213[0m:[93m7[0m - [91merror[0m[90m ts(2693): [0m'SecurityEventType' only refers to a type, but is being used as a value here.

[7m213[0m       SecurityEventType.SESSION_CREATION_FAILED,
[7m   [0m [91m      ~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m198[0m:[93m71[0m - [91merror[0m[90m ts(2554): [0mExpected 2 arguments, but got 3.

[7m198[0m     await logSecurityEvent(SecurityEventType.SESSION_CREATED, userId, {
[7m   [0m [91m                                                                      ~[0m
[7m199[0m       sessionId,
[7m   [0m [91m~~~~~~~~~~~~~~~~[0m
[7m...[0m 
[7m204[0m       twoFactorVerified: requires2FA,
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m205[0m     })
[7m   [0m [91m~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m198[0m:[93m28[0m - [91merror[0m[90m ts(2693): [0m'SecurityEventType' only refers to a type, but is being used as a value here.

[7m198[0m     await logSecurityEvent(SecurityEventType.SESSION_CREATED, userId, {
[7m   [0m [91m                           ~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m477[0m:[93m5[0m - [93mwarning[0m[90m ts(80007): [0m'await' has no effect on the type of this expression.

[7m477[0m     await logSecurityEvent(SecurityEventType.ALL_SESSIONS_DESTROYED, userId, {
[7m   [0m [93m    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m478[0m       reason,
[7m   [0m [93m~~~~~~~~~~~~~[0m
[7m479[0m       sessionCount: sessionList.length,
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m480[0m     })
[7m   [0m [93m~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m408[0m:[93m5[0m - [93mwarning[0m[90m ts(80007): [0m'await' has no effect on the type of this expression.

[7m408[0m     await logSecurityEvent(
[7m   [0m [93m    ~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m409[0m       SecurityEventType.SESSION_DESTROYED,
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m...[0m 
[7m415[0m       },
[7m   [0m [93m~~~~~~~~[0m
[7m416[0m     )
[7m   [0m [93m~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m371[0m:[93m5[0m - [93mwarning[0m[90m ts(80007): [0m'await' has no effect on the type of this expression.

[7m371[0m     await logSecurityEvent(
[7m   [0m [93m    ~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m372[0m       SecurityEventType.SESSION_REFRESHED,
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m...[0m 
[7m377[0m       },
[7m   [0m [93m~~~~~~~~[0m
[7m378[0m     )
[7m   [0m [93m~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m317[0m:[93m5[0m - [93mwarning[0m[90m ts(80007): [0m'await' has no effect on the type of this expression.

[7m317[0m     await logSecurityEvent(
[7m   [0m [93m    ~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m318[0m       SecurityEventType.SESSION_VALIDATED,
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m...[0m 
[7m323[0m       },
[7m   [0m [93m~~~~~~~~[0m
[7m324[0m     )
[7m   [0m [93m~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m289[0m:[93m7[0m - [93mwarning[0m[90m ts(80007): [0m'await' has no effect on the type of this expression.

[7m289[0m       await logSecurityEvent(
[7m   [0m [93m      ~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m290[0m         SecurityEventType.SESSION_SECURITY_ALERT,
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m...[0m 
[7m297[0m         },
[7m   [0m [93m~~~~~~~~~~[0m
[7m298[0m       )
[7m   [0m [93m~~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m264[0m:[93m11[0m - [93mwarning[0m[90m ts(80007): [0m'await' has no effect on the type of this expression.

[7m264[0m           await logSecurityEvent(
[7m   [0m [93m          ~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m265[0m             SecurityEventType.SESSION_SECURITY_ALERT,
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m...[0m 
[7m272[0m             },
[7m   [0m [93m~~~~~~~~~~~~~~[0m
[7m273[0m           )
[7m   [0m [93m~~~~~~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m212[0m:[93m5[0m - [93mwarning[0m[90m ts(80007): [0m'await' has no effect on the type of this expression.

[7m212[0m     await logSecurityEvent(
[7m   [0m [93m    ~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m213[0m       SecurityEventType.SESSION_CREATION_FAILED,
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m...[0m 
[7m218[0m       },
[7m   [0m [93m~~~~~~~~[0m
[7m219[0m     )
[7m   [0m [93m~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m198[0m:[93m5[0m - [93mwarning[0m[90m ts(80007): [0m'await' has no effect on the type of this expression.

[7m198[0m     await logSecurityEvent(SecurityEventType.SESSION_CREATED, userId, {
[7m   [0m [93m    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m199[0m       sessionId,
[7m   [0m [93m~~~~~~~~~~~~~~~~[0m
[7m...[0m 
[7m204[0m       twoFactorVerified: requires2FA,
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m205[0m     })
[7m   [0m [93m~~~~~~[0m
[96msrc/lib/auth/session-management.ts[0m:[93m8[0m:[93m28[0m - [93mwarning[0m[90m ts(6133): [0m'SecurityEventType' is declared but its value is never read.

[7m8[0m import { logSecurityEvent, SecurityEventType } from '../security'
[7m [0m [93m                           ~~~~~~~~~~~~~~~~~[0m

[96msrc/lib/auth/token-cache-service.ts[0m:[93m599[0m:[93m35[0m - [91merror[0m[90m ts(2339): [0mProperty 'pipeline' does not exist on type 'RedisClientType'.

[7m599[0m       const pipeline = this.redis.pipeline()
[7m   [0m [91m                                  ~~~~~~~~[0m
[96msrc/lib/auth/token-cache-service.ts[0m:[93m588[0m:[93m46[0m - [91merror[0m[90m ts(2551): [0mProperty 'zrangebyscore' does not exist on type 'RedisClientType'. Did you mean 'zRangeByScore'?

[7m588[0m       const expiredTokens = await this.redis.zrangebyscore(
[7m   [0m [91m                                             ~~~~~~~~~~~~~[0m
[96msrc/lib/auth/token-cache-service.ts[0m:[93m500[0m:[93m22[0m - [91merror[0m[90m ts(2551): [0mProperty 'zrem' does not exist on type 'RedisClientType'. Did you mean 'zRem'?

[7m500[0m     await this.redis.zrem('token:cache:index', tokenId)
[7m   [0m [91m                     ~~~~[0m
[96msrc/lib/auth/token-cache-service.ts[0m:[93m493[0m:[93m22[0m - [91merror[0m[90m ts(2551): [0mProperty 'zadd' does not exist on type 'RedisClientType'. Did you mean 'zAdd'?

[7m493[0m     await this.redis.zadd('token:cache:index', expiresAt, tokenId)
[7m   [0m [91m                     ~~~~[0m
[96msrc/lib/auth/token-cache-service.ts[0m:[93m467[0m:[93m47[0m - [91merror[0m[90m ts(2551): [0mProperty 'zrange' does not exist on type 'RedisClientType'. Did you mean 'zRange'?

[7m467[0m         const oldestTokens = await this.redis.zrange(
[7m   [0m [91m                                              ~~~~~~[0m
[96msrc/lib/auth/token-cache-service.ts[0m:[93m462[0m:[93m44[0m - [91merror[0m[90m ts(2551): [0mProperty 'zcard' does not exist on type 'RedisClientType'. Did you mean 'zCard'?

[7m462[0m       const currentSize = await this.redis.zcard('token:cache:index')
[7m   [0m [91m                                           ~~~~~[0m
[96msrc/lib/auth/token-cache-service.ts[0m:[93m436[0m:[93m30[0m - [91merror[0m[90m ts(2556): [0mA spread argument must either have a tuple type or be passed to a rest parameter.

[7m436[0m         await this.redis.del(...cacheKeys)
[7m   [0m [91m                             ~~~~~~~~~~~~[0m
[96msrc/lib/auth/token-cache-service.ts[0m:[93m389[0m:[93m44[0m - [91merror[0m[90m ts(2551): [0mProperty 'zrange' does not exist on type 'RedisClientType'. Did you mean 'zRange'?

[7m389[0m         const indexData = await this.redis.zrange(
[7m   [0m [91m                                           ~~~~~~[0m
[96msrc/lib/auth/token-cache-service.ts[0m:[93m360[0m:[93m24[0m - [91merror[0m[90m ts(2551): [0mProperty 'setex' does not exist on type 'RedisClientType'. Did you mean 'setEx'?

[7m360[0m       await this.redis.setex(cacheKey, ttl, dataToStore)
[7m   [0m [91m                       ~~~~~[0m
[96msrc/lib/auth/token-cache-service.ts[0m:[93m273[0m:[93m33[0m - [91merror[0m[90m ts(2339): [0mProperty 'pipeline' does not exist on type 'RedisClientType'.

[7m273[0m     const pipeline = this.redis.pipeline()
[7m   [0m [91m                                ~~~~~~~~[0m
[96msrc/lib/auth/token-cache-service.ts[0m:[93m221[0m:[93m33[0m - [91merror[0m[90m ts(2339): [0mProperty 'pipeline' does not exist on type 'RedisClientType'.

[7m221[0m     const pipeline = this.redis.pipeline()
[7m   [0m [91m                                ~~~~~~~~[0m
[96msrc/lib/auth/token-cache-service.ts[0m:[93m122[0m:[93m24[0m - [91merror[0m[90m ts(2551): [0mProperty 'setex' does not exist on type 'RedisClientType'. Did you mean 'setEx'?

[7m122[0m       await this.redis.setex(cacheKey, ttl, dataToStore)
[7m   [0m [91m                       ~~~~~[0m
[96msrc/lib/auth/token-cache-service.ts[0m:[93m8[0m:[93m10[0m - [91merror[0m[90m ts(2305): [0mModule '"../redis"' has no exported member 'getRedisClient'.

[7m8[0m import { getRedisClient } from '../redis'
[7m [0m [91m         ~~~~~~~~~~~~~~[0m

[96msrc/lib/auth/token-revocation-service.ts[0m:[93m393[0m:[93m28[0m - [91merror[0m[90m ts(2551): [0mProperty 'srem' does not exist on type 'RedisClientType'. Did you mean 'sRem'?

[7m393[0m           await this.redis.srem(userRevocationsKey, revocation.tokenId)
[7m   [0m [91m                           ~~~~[0m
[96msrc/lib/auth/token-revocation-service.ts[0m:[93m336[0m:[93m26[0m - [91merror[0m[90m ts(2551): [0mProperty 'srem' does not exist on type 'RedisClientType'. Did you mean 'sRem'?

[7m336[0m         await this.redis.srem(userRevocationsKey, tokenId)
[7m   [0m [91m                         ~~~~[0m
[96msrc/lib/auth/token-revocation-service.ts[0m:[93m329[0m:[93m45[0m - [91merror[0m[90m ts(2551): [0mProperty 'srandmember' does not exist on type 'RedisClientType'. Did you mean 'sRandMember'?

[7m329[0m       const oldestTokens = await this.redis.srandmember(
[7m   [0m [91m                                            ~~~~~~~~~~~[0m
[96msrc/lib/auth/token-revocation-service.ts[0m:[93m319[0m:[93m46[0m - [91merror[0m[90m ts(2551): [0mProperty 'scard' does not exist on type 'RedisClientType'. Did you mean 'sCard'?

[7m319[0m     const revocationCount = await this.redis.scard(userRevocationsKey)
[7m   [0m [91m                                             ~~~~~[0m
[96msrc/lib/auth/token-revocation-service.ts[0m:[93m308[0m:[93m22[0m - [91merror[0m[90m ts(2551): [0mProperty 'sadd' does not exist on type 'RedisClientType'. Did you mean 'sAdd'?

[7m308[0m     await this.redis.sadd(userRevocationsKey, tokenId)
[7m   [0m [91m                     ~~~~[0m
[96msrc/lib/auth/token-revocation-service.ts[0m:[93m287[0m:[93m22[0m - [91merror[0m[90m ts(2551): [0mProperty 'setex' does not exist on type 'RedisClientType'. Did you mean 'setEx'?

[7m287[0m     await this.redis.setex(key, ttl, JSON.stringify(record))
[7m   [0m [91m                     ~~~~~[0m
[96msrc/lib/auth/token-revocation-service.ts[0m:[93m257[0m:[93m41[0m - [91merror[0m[90m ts(2551): [0mProperty 'smembers' does not exist on type 'RedisClientType'. Did you mean 'sMembers'?

[7m257[0m       const tokenIds = await this.redis.smembers(userRevocationsKey)
[7m   [0m [91m                                        ~~~~~~~~[0m
[96msrc/lib/auth/token-revocation-service.ts[0m:[93m225[0m:[93m41[0m - [91merror[0m[90m ts(2551): [0mProperty 'smembers' does not exist on type 'RedisClientType'. Did you mean 'sMembers'?

[7m225[0m       const tokenIds = await this.redis.smembers(userRevocationsKey)
[7m   [0m [91m                                        ~~~~~~~~[0m
[96msrc/lib/auth/token-revocation-service.ts[0m:[93m8[0m:[93m10[0m - [91merror[0m[90m ts(2305): [0mModule '"../redis"' has no exported member 'getRedisClient'.

[7m8[0m import { getRedisClient } from '../redis'
[7m [0m [91m         ~~~~~~~~~~~~~~[0m

[96msrc/lib/auth/two-factor-auth.ts[0m:[93m687[0m:[93m7[0m - [91merror[0m[90m ts(2554): [0mExpected 2 arguments, but got 3.

[7m687[0m       {
[7m   [0m [91m      ~[0m
[7m688[0m         error: error instanceof Error ? error.message : 'Unknown error',
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m689[0m       },
[7m   [0m [91m~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m685[0m:[93m7[0m - [91merror[0m[90m ts(2693): [0m'SecurityEventType' only refers to a type, but is being used as a value here.

[7m685[0m       SecurityEventType.BACKUP_CODES_GENERATION_FAILED,
[7m   [0m [91m      ~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m678[0m:[93m78[0m - [91merror[0m[90m ts(2554): [0mExpected 2 arguments, but got 3.

[7m678[0m     await logSecurityEvent(SecurityEventType.BACKUP_CODES_GENERATED, userId, {
[7m   [0m [91m                                                                             ~[0m
[7m679[0m       codesGenerated: newCodes.length,
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m680[0m     })
[7m   [0m [91m~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m678[0m:[93m28[0m - [91merror[0m[90m ts(2693): [0m'SecurityEventType' only refers to a type, but is being used as a value here.

[7m678[0m     await logSecurityEvent(SecurityEventType.BACKUP_CODES_GENERATED, userId, {
[7m   [0m [91m                           ~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m674[0m:[93m12[0m - [91merror[0m[90m ts(2339): [0mProperty 'backupCodes' does not exist on type '{}'.

[7m674[0m     config.backupCodes = hashedCodes
[7m   [0m [91m           ~~~~~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m670[0m:[93m28[0m - [91merror[0m[90m ts(2339): [0mProperty 'enabled' does not exist on type '{}'.

[7m670[0m     if (!config || !config.enabled) {
[7m   [0m [91m                           ~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m629[0m:[93m7[0m - [91merror[0m[90m ts(2554): [0mExpected 2 arguments, but got 3.

[7m629[0m       {
[7m   [0m [91m      ~[0m
[7m630[0m         error: error instanceof Error ? error.message : 'Unknown error',
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m631[0m         deviceId: deviceInfo.deviceId,
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m632[0m       },
[7m   [0m [91m~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m627[0m:[93m7[0m - [91merror[0m[90m ts(2693): [0m'SecurityEventType' only refers to a type, but is being used as a value here.

[7m627[0m       SecurityEventType.TWO_FACTOR_DISABLE_FAILED,
[7m   [0m [91m      ~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m618[0m:[93m75[0m - [91merror[0m[90m ts(2554): [0mExpected 2 arguments, but got 3.

[7m618[0m     await logSecurityEvent(SecurityEventType.TWO_FACTOR_DISABLED, userId, {
[7m   [0m [91m                                                                          ~[0m
[7m619[0m       deviceId: deviceInfo.deviceId,
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m620[0m       deviceName: deviceInfo.deviceName,
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m621[0m     })
[7m   [0m [91m~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m618[0m:[93m28[0m - [91merror[0m[90m ts(2693): [0m'SecurityEventType' only refers to a type, but is being used as a value here.

[7m618[0m     await logSecurityEvent(SecurityEventType.TWO_FACTOR_DISABLED, userId, {
[7m   [0m [91m                           ~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m573[0m:[93m24[0m - [91merror[0m[90m ts(2339): [0mProperty 'lastUsed' does not exist on type '{}'.

[7m573[0m       lastUsed: config.lastUsed,
[7m   [0m [91m                       ~~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m570[0m:[93m38[0m - [91merror[0m[90m ts(2339): [0mProperty 'filter' does not exist on type '{}'.

[7m570[0m       trustedDevices: trustedDevices.filter(
[7m   [0m [91m                                     ~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m569[0m:[93m57[0m - [91merror[0m[90m ts(2339): [0mProperty 'backupCodes' does not exist on type '{}'.

[7m569[0m       backupCodesRemaining: config.backupCodes ? config.backupCodes.length : 0,
[7m   [0m [91m                                                        ~~~~~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m569[0m:[93m36[0m - [91merror[0m[90m ts(2339): [0mProperty 'backupCodes' does not exist on type '{}'.

[7m569[0m       backupCodesRemaining: config.backupCodes ? config.backupCodes.length : 0,
[7m   [0m [91m                                   ~~~~~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m568[0m:[93m29[0m - [91merror[0m[90m ts(2339): [0mProperty 'setupComplete' does not exist on type '{}'.

[7m568[0m       setupComplete: config.setupComplete,
[7m   [0m [91m                            ~~~~~~~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m567[0m:[93m23[0m - [91merror[0m[90m ts(2339): [0mProperty 'enabled' does not exist on type '{}'.

[7m567[0m       enabled: config.enabled,
[7m   [0m [91m                      ~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m529[0m:[93m35[0m - [91merror[0m[90m ts(2339): [0mProperty 'find' does not exist on type '{}'.

[7m529[0m     const device = trustedDevices.find(
[7m   [0m [91m                                  ~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m509[0m:[93m75[0m - [91merror[0m[90m ts(2554): [0mExpected 2 arguments, but got 3.

[7m509[0m     await logSecurityEvent(SecurityEventType.DEVICE_TRUST_FAILED, userId, {
[7m   [0m [91m                                                                          ~[0m
[7m510[0m       error: error instanceof Error ? error.message : 'Unknown error',
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m511[0m       deviceId: deviceInfo.deviceId,
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m512[0m     })
[7m   [0m [91m~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m509[0m:[93m28[0m - [91merror[0m[90m ts(2693): [0m'SecurityEventType' only refers to a type, but is being used as a value here.

[7m509[0m     await logSecurityEvent(SecurityEventType.DEVICE_TRUST_FAILED, userId, {
[7m   [0m [91m                           ~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m504[0m:[93m70[0m - [91merror[0m[90m ts(2554): [0mExpected 2 arguments, but got 3.

[7m504[0m     await logSecurityEvent(SecurityEventType.DEVICE_TRUSTED, userId, {
[7m   [0m [91m                                                                     ~[0m
[7m505[0m       deviceId: deviceInfo.deviceId,
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m506[0m       deviceName: deviceInfo.deviceName,
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m507[0m     })
[7m   [0m [91m~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m504[0m:[93m28[0m - [91merror[0m[90m ts(2693): [0m'SecurityEventType' only refers to a type, but is being used as a value here.

[7m504[0m     await logSecurityEvent(SecurityEventType.DEVICE_TRUSTED, userId, {
[7m   [0m [91m                           ~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m498[0m:[93m22[0m - [91merror[0m[90m ts(2339): [0mProperty 'push' does not exist on type '{}'.

[7m498[0m       trustedDevices.push(newDevice)
[7m   [0m [91m                     ~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m481[0m:[93m41[0m - [91merror[0m[90m ts(2339): [0mProperty 'slice' does not exist on type '{}'.

[7m481[0m         trustedDevices = trustedDevices.slice(
[7m   [0m [91m                                        ~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m478[0m:[93m24[0m - [91merror[0m[90m ts(2339): [0mProperty 'sort' does not exist on type '{}'.

[7m478[0m         trustedDevices.sort(
[7m   [0m [91m                       ~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m476[0m:[93m26[0m - [91merror[0m[90m ts(2339): [0mProperty 'length' does not exist on type '{}'.

[7m476[0m       if (trustedDevices.length >= DEVICE_TRUST_CONFIG.maxTrustedDevices) {
[7m   [0m [91m                         ~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m466[0m:[93m43[0m - [91merror[0m[90m ts(2339): [0mProperty 'find' does not exist on type '{}'.

[7m466[0m     const existingDevice = trustedDevices.find(
[7m   [0m [91m                                          ~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m442[0m:[93m28[0m - [91merror[0m[90m ts(2339): [0mProperty 'backupCodes' does not exist on type '{}'.

[7m442[0m     codesRemaining: config.backupCodes.length,
[7m   [0m [91m                           ~~~~~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m441[0m:[93m70[0m - [91merror[0m[90m ts(2554): [0mExpected 2 arguments, but got 3.

[7m441[0m   await logSecurityEvent(SecurityEventType.BACKUP_CODE_USED, userId, {
[7m   [0m [91m                                                                     ~[0m
[7m442[0m     codesRemaining: config.backupCodes.length,
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m443[0m   })
[7m   [0m [91m~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m441[0m:[93m26[0m - [91merror[0m[90m ts(2693): [0m'SecurityEventType' only refers to a type, but is being used as a value here.

[7m441[0m   await logSecurityEvent(SecurityEventType.BACKUP_CODE_USED, userId, {
[7m   [0m [91m                         ~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m437[0m:[93m10[0m - [91merror[0m[90m ts(2339): [0mProperty 'backupCodes' does not exist on type '{}'.

[7m437[0m   config.backupCodes.splice(codeIndex, 1)
[7m   [0m [91m         ~~~~~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m431[0m:[93m28[0m - [91merror[0m[90m ts(2339): [0mProperty 'backupCodes' does not exist on type '{}'.

[7m431[0m   const codeIndex = config.backupCodes.indexOf(hashedInput)
[7m   [0m [91m                           ~~~~~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m424[0m:[93m48[0m - [91merror[0m[90m ts(2339): [0mProperty 'backupCodes' does not exist on type '{}'.

[7m424[0m   if (!config || !config.backupCodes || config.backupCodes.length === 0) {
[7m   [0m [91m                                               ~~~~~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m424[0m:[93m26[0m - [91merror[0m[90m ts(2339): [0mProperty 'backupCodes' does not exist on type '{}'.

[7m424[0m   if (!config || !config.backupCodes || config.backupCodes.length === 0) {
[7m   [0m [91m                         ~~~~~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m404[0m:[93m7[0m - [91merror[0m[90m ts(2554): [0mExpected 2 arguments, but got 3.

[7m404[0m       {
[7m   [0m [91m      ~[0m
[7m405[0m         error: error instanceof Error ? error.message : 'Unknown error',
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m406[0m         deviceId,
[7m   [0m [91m~~~~~~~~~~~~~~~~~[0m
[7m407[0m       },
[7m   [0m [91m~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m402[0m:[93m7[0m - [91merror[0m[90m ts(2693): [0m'SecurityEventType' only refers to a type, but is being used as a value here.

[7m402[0m       SecurityEventType.TWO_FACTOR_VERIFICATION_FAILED,
[7m   [0m [91m      ~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m390[0m:[93m7[0m - [91merror[0m[90m ts(2554): [0mExpected 2 arguments, but got 3.

[7m390[0m       {
[7m   [0m [91m      ~[0m
[7m391[0m         method: verificationMethod,
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m392[0m         deviceId,
[7m   [0m [91m~~~~~~~~~~~~~~~~~[0m
[7m393[0m       },
[7m   [0m [91m~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m388[0m:[93m7[0m - [91merror[0m[90m ts(2693): [0m'SecurityEventType' only refers to a type, but is being used as a value here.

[7m388[0m       SecurityEventType.TWO_FACTOR_VERIFICATION_SUCCESS,
[7m   [0m [91m      ~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m372[0m:[93m12[0m - [91merror[0m[90m ts(2339): [0mProperty 'lastUsed' does not exist on type '{}'.

[7m372[0m     config.lastUsed = Date.now()
[7m   [0m [91m           ~~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m360[0m:[93m30[0m - [91merror[0m[90m ts(2339): [0mProperty 'count' does not exist on type '{}'.

[7m360[0m           attempts: attempts.count,
[7m   [0m [91m                             ~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m357[0m:[93m9[0m - [91merror[0m[90m ts(2554): [0mExpected 2 arguments, but got 3.

[7m357[0m         {
[7m   [0m [91m        ~[0m
[7m358[0m           method: verificationMethod,
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m...[0m 
[7m360[0m           attempts: attempts.count,
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m361[0m         },
[7m   [0m [91m~~~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m355[0m:[93m9[0m - [91merror[0m[90m ts(2693): [0m'SecurityEventType' only refers to a type, but is being used as a value here.

[7m355[0m         SecurityEventType.TWO_FACTOR_VERIFICATION_FAILED,
[7m   [0m [91m        ~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m350[0m:[93m30[0m - [91merror[0m[90m ts(2339): [0mProperty 'count' does not exist on type '{}'.

[7m350[0m           attempts: attempts.count,
[7m   [0m [91m                             ~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m348[0m:[93m74[0m - [91merror[0m[90m ts(2554): [0mExpected 2 arguments, but got 3.

[7m348[0m         await logSecurityEvent(SecurityEventType.ACCOUNT_LOCKED, userId, {
[7m   [0m [91m                                                                         ~[0m
[7m349[0m           reason: '2fa_failed_attempts',
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m350[0m           attempts: attempts.count,
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m351[0m         })
[7m   [0m [91m~~~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m348[0m:[93m32[0m - [91merror[0m[90m ts(2693): [0m'SecurityEventType' only refers to a type, but is being used as a value here.

[7m348[0m         await logSecurityEvent(SecurityEventType.ACCOUNT_LOCKED, userId, {
[7m   [0m [91m                               ~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m343[0m:[93m32[0m - [91merror[0m[90m ts(2339): [0mProperty 'count' does not exist on type '{}'.

[7m343[0m             attempts: attempts.count,
[7m   [0m [91m                               ~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m337[0m:[93m20[0m - [91merror[0m[90m ts(2339): [0mProperty 'count' does not exist on type '{}'.

[7m337[0m       if (attempts.count >= 5) {
[7m   [0m [91m                   ~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m332[0m:[93m16[0m - [91merror[0m[90m ts(2339): [0mProperty 'lastAttempt' does not exist on type '{}'.

[7m332[0m       attempts.lastAttempt = Date.now()
[7m   [0m [91m               ~~~~~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m331[0m:[93m16[0m - [91merror[0m[90m ts(2339): [0mProperty 'count' does not exist on type '{}'.

[7m331[0m       attempts.count += 1
[7m   [0m [91m               ~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m314[0m:[93m24[0m - [91merror[0m[90m ts(2339): [0mProperty 'secret' does not exist on type '{}'.

[7m314[0m         secret: config.secret,
[7m   [0m [91m                       ~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m297[0m:[93m36[0m - [91merror[0m[90m ts(2339): [0mProperty 'lockedUntil' does not exist on type '{}'.

[7m297[0m     if (lockoutData && lockoutData.lockedUntil > Date.now()) {
[7m   [0m [91m                                   ~~~~~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m290[0m:[93m28[0m - [91merror[0m[90m ts(2339): [0mProperty 'enabled' does not exist on type '{}'.

[7m290[0m     if (!config || !config.enabled) {
[7m   [0m [91m                           ~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m267[0m:[93m79[0m - [91merror[0m[90m ts(2554): [0mExpected 2 arguments, but got 3.

[7m267[0m     await logSecurityEvent(SecurityEventType.TWO_FACTOR_SETUP_FAILED, userId, {
[7m   [0m [91m                                                                              ~[0m
[7m268[0m       error: error instanceof Error ? error.message : 'Unknown error',
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m269[0m       deviceId: deviceInfo.deviceId,
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m270[0m     })
[7m   [0m [91m~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m267[0m:[93m28[0m - [91merror[0m[90m ts(2693): [0m'SecurityEventType' only refers to a type, but is being used as a value here.

[7m267[0m     await logSecurityEvent(SecurityEventType.TWO_FACTOR_SETUP_FAILED, userId, {
[7m   [0m [91m                           ~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m258[0m:[93m7[0m - [91merror[0m[90m ts(2554): [0mExpected 2 arguments, but got 3.

[7m258[0m       {
[7m   [0m [91m      ~[0m
[7m259[0m         deviceId: deviceInfo.deviceId,
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m260[0m         deviceName: deviceInfo.deviceName,
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m261[0m       },
[7m   [0m [91m~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m256[0m:[93m7[0m - [91merror[0m[90m ts(2693): [0m'SecurityEventType' only refers to a type, but is being used as a value here.

[7m256[0m       SecurityEventType.TWO_FACTOR_SETUP_COMPLETED,
[7m   [0m [91m      ~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m235[0m:[93m30[0m - [91merror[0m[90m ts(2339): [0mProperty 'backupCodes' does not exist on type '{}'.

[7m235[0m       backupCodes: setupData.backupCodes,
[7m   [0m [91m                             ~~~~~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m234[0m:[93m25[0m - [91merror[0m[90m ts(2339): [0mProperty 'secret' does not exist on type '{}'.

[7m234[0m       secret: setupData.secret,
[7m   [0m [91m                        ~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m221[0m:[93m25[0m - [91merror[0m[90m ts(2339): [0mProperty 'secret' does not exist on type '{}'.

[7m221[0m       secret: setupData.secret,
[7m   [0m [91m                        ~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m214[0m:[93m33[0m - [91merror[0m[90m ts(2339): [0mProperty 'setupComplete' does not exist on type '{}'.

[7m214[0m     if (!setupData || setupData.setupComplete) {
[7m   [0m [91m                                ~~~~~~~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m188[0m:[93m79[0m - [91merror[0m[90m ts(2554): [0mExpected 2 arguments, but got 3.

[7m188[0m     await logSecurityEvent(SecurityEventType.TWO_FACTOR_SETUP_FAILED, userId, {
[7m   [0m [91m                                                                              ~[0m
[7m189[0m       error: error instanceof Error ? error.message : 'Unknown error',
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m190[0m       deviceId: deviceInfo.deviceId,
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m191[0m     })
[7m   [0m [91m~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m188[0m:[93m28[0m - [91merror[0m[90m ts(2693): [0m'SecurityEventType' only refers to a type, but is being used as a value here.

[7m188[0m     await logSecurityEvent(SecurityEventType.TWO_FACTOR_SETUP_FAILED, userId, {
[7m   [0m [91m                           ~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m172[0m:[93m7[0m - [91merror[0m[90m ts(2554): [0mExpected 2 arguments, but got 3.

[7m172[0m       {
[7m   [0m [91m      ~[0m
[7m173[0m         deviceId: deviceInfo.deviceId,
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m174[0m         deviceName: deviceInfo.deviceName,
[7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m175[0m       },
[7m   [0m [91m~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m170[0m:[93m7[0m - [91merror[0m[90m ts(2693): [0m'SecurityEventType' only refers to a type, but is being used as a value here.

[7m170[0m       SecurityEventType.TWO_FACTOR_SETUP_INITIATED,
[7m   [0m [91m      ~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m8[0m:[93m20[0m - [91merror[0m[90m ts(2307): [0mCannot find module 'qrcode' or its corresponding type declarations.

[7m8[0m import QRCode from 'qrcode'
[7m [0m [91m                   ~~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m6[0m:[93m31[0m - [91merror[0m[90m ts(2307): [0mCannot find module 'otplib' or its corresponding type declarations.

[7m6[0m import { authenticator } from 'otplib'
[7m [0m [91m                              ~~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m684[0m:[93m5[0m - [93mwarning[0m[90m ts(80007): [0m'await' has no effect on the type of this expression.

[7m684[0m     await logSecurityEvent(
[7m   [0m [93m    ~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m685[0m       SecurityEventType.BACKUP_CODES_GENERATION_FAILED,
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m...[0m 
[7m689[0m       },
[7m   [0m [93m~~~~~~~~[0m
[7m690[0m     )
[7m   [0m [93m~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m678[0m:[93m5[0m - [93mwarning[0m[90m ts(80007): [0m'await' has no effect on the type of this expression.

[7m678[0m     await logSecurityEvent(SecurityEventType.BACKUP_CODES_GENERATED, userId, {
[7m   [0m [93m    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m679[0m       codesGenerated: newCodes.length,
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m680[0m     })
[7m   [0m [93m~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m626[0m:[93m5[0m - [93mwarning[0m[90m ts(80007): [0m'await' has no effect on the type of this expression.

[7m626[0m     await logSecurityEvent(
[7m   [0m [93m    ~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m627[0m       SecurityEventType.TWO_FACTOR_DISABLE_FAILED,
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m...[0m 
[7m632[0m       },
[7m   [0m [93m~~~~~~~~[0m
[7m633[0m     )
[7m   [0m [93m~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m618[0m:[93m5[0m - [93mwarning[0m[90m ts(80007): [0m'await' has no effect on the type of this expression.

[7m618[0m     await logSecurityEvent(SecurityEventType.TWO_FACTOR_DISABLED, userId, {
[7m   [0m [93m    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m619[0m       deviceId: deviceInfo.deviceId,
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m620[0m       deviceName: deviceInfo.deviceName,
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m621[0m     })
[7m   [0m [93m~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m509[0m:[93m5[0m - [93mwarning[0m[90m ts(80007): [0m'await' has no effect on the type of this expression.

[7m509[0m     await logSecurityEvent(SecurityEventType.DEVICE_TRUST_FAILED, userId, {
[7m   [0m [93m    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m510[0m       error: error instanceof Error ? error.message : 'Unknown error',
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m511[0m       deviceId: deviceInfo.deviceId,
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m512[0m     })
[7m   [0m [93m~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m504[0m:[93m5[0m - [93mwarning[0m[90m ts(80007): [0m'await' has no effect on the type of this expression.

[7m504[0m     await logSecurityEvent(SecurityEventType.DEVICE_TRUSTED, userId, {
[7m   [0m [93m    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m505[0m       deviceId: deviceInfo.deviceId,
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m506[0m       deviceName: deviceInfo.deviceName,
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m507[0m     })
[7m   [0m [93m~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m441[0m:[93m3[0m - [93mwarning[0m[90m ts(80007): [0m'await' has no effect on the type of this expression.

[7m441[0m   await logSecurityEvent(SecurityEventType.BACKUP_CODE_USED, userId, {
[7m   [0m [93m  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m442[0m     codesRemaining: config.backupCodes.length,
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m443[0m   })
[7m   [0m [93m~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m401[0m:[93m5[0m - [93mwarning[0m[90m ts(80007): [0m'await' has no effect on the type of this expression.

[7m401[0m     await logSecurityEvent(
[7m   [0m [93m    ~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m402[0m       SecurityEventType.TWO_FACTOR_VERIFICATION_FAILED,
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m...[0m 
[7m407[0m       },
[7m   [0m [93m~~~~~~~~[0m
[7m408[0m     )
[7m   [0m [93m~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m387[0m:[93m5[0m - [93mwarning[0m[90m ts(80007): [0m'await' has no effect on the type of this expression.

[7m387[0m     await logSecurityEvent(
[7m   [0m [93m    ~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m388[0m       SecurityEventType.TWO_FACTOR_VERIFICATION_SUCCESS,
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m...[0m 
[7m393[0m       },
[7m   [0m [93m~~~~~~~~[0m
[7m394[0m     )
[7m   [0m [93m~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m354[0m:[93m7[0m - [93mwarning[0m[90m ts(80007): [0m'await' has no effect on the type of this expression.

[7m354[0m       await logSecurityEvent(
[7m   [0m [93m      ~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m355[0m         SecurityEventType.TWO_FACTOR_VERIFICATION_FAILED,
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m...[0m 
[7m361[0m         },
[7m   [0m [93m~~~~~~~~~~[0m
[7m362[0m       )
[7m   [0m [93m~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m348[0m:[93m9[0m - [93mwarning[0m[90m ts(80007): [0m'await' has no effect on the type of this expression.

[7m348[0m         await logSecurityEvent(SecurityEventType.ACCOUNT_LOCKED, userId, {
[7m   [0m [93m        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m349[0m           reason: '2fa_failed_attempts',
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m350[0m           attempts: attempts.count,
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m351[0m         })
[7m   [0m [93m~~~~~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m267[0m:[93m5[0m - [93mwarning[0m[90m ts(80007): [0m'await' has no effect on the type of this expression.

[7m267[0m     await logSecurityEvent(SecurityEventType.TWO_FACTOR_SETUP_FAILED, userId, {
[7m   [0m [93m    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m268[0m       error: error instanceof Error ? error.message : 'Unknown error',
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m269[0m       deviceId: deviceInfo.deviceId,
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m270[0m     })
[7m   [0m [93m~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m255[0m:[93m5[0m - [93mwarning[0m[90m ts(80007): [0m'await' has no effect on the type of this expression.

[7m255[0m     await logSecurityEvent(
[7m   [0m [93m    ~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m256[0m       SecurityEventType.TWO_FACTOR_SETUP_COMPLETED,
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m...[0m 
[7m261[0m       },
[7m   [0m [93m~~~~~~~~[0m
[7m262[0m     )
[7m   [0m [93m~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m188[0m:[93m5[0m - [93mwarning[0m[90m ts(80007): [0m'await' has no effect on the type of this expression.

[7m188[0m     await logSecurityEvent(SecurityEventType.TWO_FACTOR_SETUP_FAILED, userId, {
[7m   [0m [93m    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m189[0m       error: error instanceof Error ? error.message : 'Unknown error',
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m190[0m       deviceId: deviceInfo.deviceId,
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m191[0m     })
[7m   [0m [93m~~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m169[0m:[93m5[0m - [93mwarning[0m[90m ts(80007): [0m'await' has no effect on the type of this expression.

[7m169[0m     await logSecurityEvent(
[7m   [0m [93m    ~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m170[0m       SecurityEventType.TWO_FACTOR_SETUP_INITIATED,
[7m   [0m [93m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m...[0m 
[7m175[0m       },
[7m   [0m [93m~~~~~~~~[0m
[7m176[0m     )
[7m   [0m [93m~~~~~[0m
[96msrc/lib/auth/two-factor-auth.ts[0m:[93m10[0m:[93m28[0m - [93mwarning[0m[90m ts(6133): [0m'SecurityEventType' is declared but its value is never read.

[7m10[0m import { logSecurityEvent, SecurityEventType } from '../security'
[7m  [0m [93m                           ~~~~~~~~~~~~~~~~~[0m

[96msrc/lib/auth/__tests__/better-auth-integration.test.ts[0m:[93m1182[0m:[93m48[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'string' is not assignable to parameter of type 'void'.

[7m1182[0m       vi.mocked(bcrypt.hash).mockResolvedValue('hashedPassword123')
[7m    [0m [91m                                               ~~~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/better-auth-integration.test.ts[0m:[93m1173[0m:[93m16[0m - [91merror[0m[90m ts(18048): [0m'loggedData' is possibly 'undefined'.

[7m1173[0m         expect(loggedData.clientInfo.ip).toBeUndefined()
[7m    [0m [91m               ~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/better-auth-integration.test.ts[0m:[93m1172[0m:[93m11[0m - [91merror[0m[90m ts(18048): [0m'loggedData' is possibly 'undefined'.

[7m1172[0m       if (loggedData.clientInfo) {
[7m    [0m [91m          ~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/better-auth-integration.test.ts[0m:[93m1169[0m:[93m68[0m - [91merror[0m[90m ts(2493): [0mTuple type '[eventType: SecurityEventType, details: Record<string, string | number | boolean | null | undefined>]' of length '2' has no element at index '2'.

[7m1169[0m       const loggedData = vi.mocked(logSecurityEvent).mock.calls[0][2]
[7m    [0m [91m                                                                   ~[0m
[96msrc/lib/auth/__tests__/better-auth-integration.test.ts[0m:[93m1146[0m:[93m9[0m - [91merror[0m[90m ts(2353): [0mObject literal may only specify known properties, and 'firstName' does not exist in type '{ id: string; createdAt: Date; updatedAt: Date; email: string; emailVerified: boolean; name: string; image?: string | null | undefined; }'.

[7m1146[0m         firstName: mockUserData.firstName,
[7m    [0m [91m        ~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/better-auth-integration.test.ts[0m:[93m1131[0m:[93m68[0m - [91merror[0m[90m ts(2493): [0mTuple type '[eventType: SecurityEventType, details: Record<string, string | number | boolean | null | undefined>]' of length '2' has no element at index '2'.

[7m1131[0m       const loggedData = vi.mocked(logSecurityEvent).mock.calls[0][2]
[7m    [0m [91m                                                                   ~[0m
[96msrc/lib/auth/__tests__/better-auth-integration.test.ts[0m:[93m1108[0m:[93m9[0m - [91merror[0m[90m ts(2353): [0mObject literal may only specify known properties, and 'firstName' does not exist in type '{ id: string; createdAt: Date; updatedAt: Date; email: string; emailVerified: boolean; name: string; image?: string | null | undefined; }'.

[7m1108[0m         firstName: mockUserData.firstName,
[7m    [0m [91m        ~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/better-auth-integration.test.ts[0m:[93m1077[0m:[93m48[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'string' is not assignable to parameter of type 'void'.

[7m1077[0m       vi.mocked(bcrypt.hash).mockResolvedValue('hashedPassword123')
[7m    [0m [91m                                               ~~~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/better-auth-integration.test.ts[0m:[93m982[0m:[93m9[0m - [91merror[0m[90m ts(2353): [0mObject literal may only specify known properties, and 'firstName' does not exist in type '{ id: string; createdAt: Date; updatedAt: Date; email: string; emailVerified: boolean; name: string; image?: string | null | undefined; }'.

[7m982[0m         firstName: mockUserData.firstName,
[7m   [0m [91m        ~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/better-auth-integration.test.ts[0m:[93m962[0m:[93m48[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'string' is not assignable to parameter of type 'void'.

[7m962[0m       vi.mocked(bcrypt.hash).mockResolvedValue('hashedPassword123')
[7m   [0m [91m                                               ~~~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/better-auth-integration.test.ts[0m:[93m927[0m:[93m9[0m - [91merror[0m[90m ts(2353): [0mObject literal may only specify known properties, and 'firstName' does not exist in type '{ id: string; createdAt: Date; updatedAt: Date; email: string; emailVerified: boolean; name: string; image?: string | null | undefined; }'.

[7m927[0m         firstName: mockUserData.firstName,
[7m   [0m [91m        ~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/better-auth-integration.test.ts[0m:[93m899[0m:[93m9[0m - [91merror[0m[90m ts(2353): [0mObject literal may only specify known properties, and 'firstName' does not exist in type '{ id: string; createdAt: Date; updatedAt: Date; email: string; emailVerified: boolean; name: string; image?: string | null | undefined; }'.

[7m899[0m         firstName: mockUserData.firstName,
[7m   [0m [91m        ~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/better-auth-integration.test.ts[0m:[93m872[0m:[93m9[0m - [91merror[0m[90m ts(2353): [0mObject literal may only specify known properties, and 'firstName' does not exist in type '{ id: string; createdAt: Date; updatedAt: Date; email: string; emailVerified: boolean; name: string; image?: string | null | undefined; }'.

[7m872[0m         firstName: mockUserData.firstName,
[7m   [0m [91m        ~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/better-auth-integration.test.ts[0m:[93m845[0m:[93m9[0m - [91merror[0m[90m ts(2353): [0mObject literal may only specify known properties, and 'firstName' does not exist in type '{ id: string; createdAt: Date; updatedAt: Date; email: string; emailVerified: boolean; name: string; image?: string | null | undefined; }'.

[7m845[0m         firstName: mockUserData.firstName,
[7m   [0m [91m        ~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/better-auth-integration.test.ts[0m:[93m816[0m:[93m52[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'string' is not assignable to parameter of type 'void'.

[7m816[0m       vi.mocked(bcrypt.hash).mockResolvedValueOnce('newHashedPassword')
[7m   [0m [91m                                                   ~~~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/better-auth-integration.test.ts[0m:[93m776[0m:[93m52[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'string' is not assignable to parameter of type 'void'.

[7m776[0m       vi.mocked(bcrypt.hash).mockResolvedValueOnce('newHashedPassword')
[7m   [0m [91m                                                   ~~~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/better-auth-integration.test.ts[0m:[93m768[0m:[93m17[0m - [91merror[0m[90m ts(2304): [0mCannot find name 'getFromCache'.

[7m768[0m       vi.mocked(getFromCache).mockImplementation(async (_key) => {
[7m   [0m [91m                ~~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/better-auth-integration.test.ts[0m:[93m700[0m:[93m52[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'string' is not assignable to parameter of type 'void'.

[7m700[0m       vi.mocked(bcrypt.hash).mockResolvedValueOnce('newHashedPassword')
[7m   [0m [91m                                                   ~~~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/better-auth-integration.test.ts[0m:[93m649[0m:[93m9[0m - [91merror[0m[90m ts(2353): [0mObject literal may only specify known properties, and 'firstName' does not exist in type '{ id: string; createdAt: Date; updatedAt: Date; email: string; emailVerified: boolean; name: string; image?: string | null | undefined; }'.

[7m649[0m         firstName: mockUserData.firstName,
[7m   [0m [91m        ~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/better-auth-integration.test.ts[0m:[93m617[0m:[93m9[0m - [91merror[0m[90m ts(2353): [0mObject literal may only specify known properties, and 'firstName' does not exist in type '{ id: string; createdAt: Date; updatedAt: Date; email: string; emailVerified: boolean; name: string; image?: string | null | undefined; }'.

[7m617[0m         firstName: mockUserData.firstName,
[7m   [0m [91m        ~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/better-auth-integration.test.ts[0m:[93m566[0m:[93m9[0m - [91merror[0m[90m ts(2353): [0mObject literal may only specify known properties, and 'firstName' does not exist in type '{ id: string; createdAt: Date; updatedAt: Date; email: string; emailVerified: boolean; name: string; image?: string | null | undefined; }'.

[7m566[0m         firstName: mockUserData.firstName,
[7m   [0m [91m        ~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/better-auth-integration.test.ts[0m:[93m497[0m:[93m9[0m - [91merror[0m[90m ts(2353): [0mObject literal may only specify known properties, and 'firstName' does not exist in type '{ id: string; createdAt: Date; updatedAt: Date; email: string; emailVerified: boolean; name: string; image?: string | null | undefined; }'.

[7m497[0m         firstName: mockUserData.firstName,
[7m   [0m [91m        ~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/better-auth-integration.test.ts[0m:[93m377[0m:[93m9[0m - [91merror[0m[90m ts(2353): [0mObject literal may only specify known properties, and 'firstName' does not exist in type '{ id: string; createdAt: Date; updatedAt: Date; email: string; emailVerified: boolean; name: string; image?: string | null | undefined; }'.

[7m377[0m         firstName: mockUserData.firstName,
[7m   [0m [91m        ~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/better-auth-integration.test.ts[0m:[93m338[0m:[93m9[0m - [91merror[0m[90m ts(2353): [0mObject literal may only specify known properties, and 'firstName' does not exist in type '{ id: string; createdAt: Date; updatedAt: Date; email: string; emailVerified: boolean; name: string; image?: string | null | undefined; }'.

[7m338[0m         firstName: mockUserData.firstName,
[7m   [0m [91m        ~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/better-auth-integration.test.ts[0m:[93m310[0m:[93m12[0m - [91merror[0m[90m ts(2304): [0mCannot find name 'mockUser'.

[7m310[0m         ...mockUser,
[7m   [0m [91m           ~~~~~~~~[0m
[96msrc/lib/auth/__tests__/better-auth-integration.test.ts[0m:[93m279[0m:[93m9[0m - [91merror[0m[90m ts(2353): [0mObject literal may only specify known properties, and 'firstName' does not exist in type '{ id: string; createdAt: Date; updatedAt: Date; email: string; emailVerified: boolean; name: string; image?: string | null | undefined; }'.

[7m279[0m         firstName: mockUserData.firstName,
[7m   [0m [91m        ~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/better-auth-integration.test.ts[0m:[93m228[0m:[93m9[0m - [91merror[0m[90m ts(2353): [0mObject literal may only specify known properties, and 'firstName' does not exist in type '{ id: string; createdAt: Date; updatedAt: Date; email: string; emailVerified: boolean; name: string; image?: string | null | undefined; }'.

[7m228[0m         firstName: mockUserData.firstName,
[7m   [0m [91m        ~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/better-auth-integration.test.ts[0m:[93m205[0m:[93m48[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'string' is not assignable to parameter of type 'void'.

[7m205[0m       vi.mocked(bcrypt.hash).mockResolvedValue('hashedPassword123')
[7m   [0m [91m                                               ~~~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/better-auth-integration.test.ts[0m:[93m190[0m:[93m48[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'string' is not assignable to parameter of type 'void'.

[7m190[0m       vi.mocked(bcrypt.hash).mockResolvedValue('hashedPassword123')
[7m   [0m [91m                                               ~~~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/better-auth-integration.test.ts[0m:[93m169[0m:[93m48[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'string' is not assignable to parameter of type 'void'.

[7m169[0m       vi.mocked(bcrypt.hash).mockResolvedValue('hashedPassword123')
[7m   [0m [91m                                               ~~~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/better-auth-integration.test.ts[0m:[93m114[0m:[93m48[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'string' is not assignable to parameter of type 'void'.

[7m114[0m       vi.mocked(bcrypt.hash).mockResolvedValue('hashedPassword123')
[7m   [0m [91m                                               ~~~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/better-auth-integration.test.ts[0m:[93m90[0m:[93m48[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'string' is not assignable to parameter of type 'void'.

[7m90[0m       vi.mocked(bcrypt.hash).mockResolvedValue('hashedPassword123')
[7m  [0m [91m                                               ~~~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/better-auth-integration.test.ts[0m:[93m17[0m:[93m8[0m - [91merror[0m[90m ts(2459): [0mModule '"../better-auth-integration"' declares 'UserRole' locally, but it is not exported.

[7m17[0m   type UserRole,
[7m  [0m [91m       ~~~~~~~~[0m
[96msrc/lib/auth/__tests__/better-auth-integration.test.ts[0m:[93m15[0m:[93m3[0m - [91merror[0m[90m ts(2459): [0mModule '"../better-auth-integration"' declares 'AuthenticationError' locally, but it is not exported.

[7m15[0m   AuthenticationError,
[7m  [0m [91m  ~~~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/better-auth-integration.test.ts[0m:[93m14[0m:[93m3[0m - [91merror[0m[90m ts(2305): [0mModule '"../better-auth-integration"' has no exported member 'validateUserRole'.

[7m14[0m   validateUserRole,
[7m  [0m [91m  ~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/better-auth-integration.test.ts[0m:[93m13[0m:[93m3[0m - [91merror[0m[90m ts(2305): [0mModule '"../better-auth-integration"' has no exported member 'changePassword'.

[7m13[0m   changePassword,
[7m  [0m [91m  ~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/better-auth-integration.test.ts[0m:[93m12[0m:[93m3[0m - [91merror[0m[90m ts(2305): [0mModule '"../better-auth-integration"' has no exported member 'updateUserProfile'.

[7m12[0m   updateUserProfile,
[7m  [0m [91m  ~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/better-auth-integration.test.ts[0m:[93m11[0m:[93m3[0m - [91merror[0m[90m ts(2305): [0mModule '"../better-auth-integration"' has no exported member 'getUserById'.

[7m11[0m   getUserById,
[7m  [0m [91m  ~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/better-auth-integration.test.ts[0m:[93m10[0m:[93m3[0m - [91merror[0m[90m ts(2305): [0mModule '"../better-auth-integration"' has no exported member 'logoutUser'.

[7m10[0m   logoutUser,
[7m  [0m [91m  ~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/better-auth-integration.test.ts[0m:[93m9[0m:[93m3[0m - [91merror[0m[90m ts(2305): [0mModule '"../better-auth-integration"' has no exported member 'loginUser'.

[7m9[0m   loginUser,
[7m [0m [91m  ~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/better-auth-integration.test.ts[0m:[93m8[0m:[93m3[0m - [91merror[0m[90m ts(2305): [0mModule '"../better-auth-integration"' has no exported member 'registerUser'.

[7m8[0m   registerUser,
[7m [0m [91m  ~~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/better-auth-integration.test.ts[0m:[93m768[0m:[93m57[0m - [93mwarning[0m[90m ts(7044): [0mParameter '_key' implicitly has an 'any' type, but a better type may be inferred from usage.

[7m768[0m       vi.mocked(getFromCache).mockImplementation(async (_key) => {
[7m   [0m [93m                                                        ~~~~[0m

[96msrc/lib/auth/__tests__/integration.test.ts[0m:[93m716[0m:[93m16[0m - [91merror[0m[90m ts(18048): [0m'loggedData' is possibly 'undefined'.

[7m716[0m         expect(loggedData.clientInfo.ip).toBeUndefined()
[7m   [0m [91m               ~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/integration.test.ts[0m:[93m715[0m:[93m11[0m - [91merror[0m[90m ts(18048): [0m'loggedData' is possibly 'undefined'.

[7m715[0m       if (loggedData.clientInfo) {
[7m   [0m [91m          ~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/integration.test.ts[0m:[93m712[0m:[93m68[0m - [91merror[0m[90m ts(2493): [0mTuple type '[eventType: SecurityEventType, details: Record<string, string | number | boolean | null | undefined>]' of length '2' has no element at index '2'.

[7m712[0m       const loggedData = vi.mocked(logSecurityEvent).mock.calls[0][2]
[7m   [0m [91m                                                                   ~[0m
[96msrc/lib/auth/__tests__/integration.test.ts[0m:[93m664[0m:[93m68[0m - [91merror[0m[90m ts(2493): [0mTuple type '[eventType: SecurityEventType, details: Record<string, string | number | boolean | null | undefined>]' of length '2' has no element at index '2'.

[7m664[0m       const loggedData = vi.mocked(logSecurityEvent).mock.calls[0][2]
[7m   [0m [91m                                                                   ~[0m
[96msrc/lib/auth/__tests__/integration.test.ts[0m:[93m495[0m:[93m51[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'boolean' is not assignable to parameter of type 'void'.

[7m495[0m       vi.mocked(bcrypt.compare).mockResolvedValue(false)
[7m   [0m [91m                                                  ~~~~~[0m
[96msrc/lib/auth/__tests__/integration.test.ts[0m:[93m315[0m:[93m48[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'Request' is not assignable to parameter of type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>'.
  Type 'Request' is missing the following properties from type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>': get, header, accepts, acceptsCharsets, and 93 more.

[7m315[0m       const result = await authenticateRequest(request)
[7m   [0m [91m                                               ~~~~~~~[0m
[96msrc/lib/auth/__tests__/integration.test.ts[0m:[93m290[0m:[93m30[0m - [91merror[0m[90m ts(2339): [0mProperty 'getUserById' does not exist on type 'typeof import("/home/vivi/pixelated/src/lib/auth/jwt-service")'.

[7m290[0m       const { validateToken, getUserById } = await import('../jwt-service')
[7m   [0m [91m                             ~~~~~~~~~~~[0m

[96msrc/lib/auth/__tests__/jwt-service.test.ts[0m:[93m619[0m:[93m16[0m - [91merror[0m[90m ts(18048): [0m'loggedData' is possibly 'undefined'.

[7m619[0m         expect(loggedData.clientInfo.ip).toBeUndefined()
[7m   [0m [91m               ~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/jwt-service.test.ts[0m:[93m618[0m:[93m11[0m - [91merror[0m[90m ts(18048): [0m'loggedData' is possibly 'undefined'.

[7m618[0m       if (loggedData.clientInfo) {
[7m   [0m [91m          ~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/jwt-service.test.ts[0m:[93m615[0m:[93m68[0m - [91merror[0m[90m ts(2493): [0mTuple type '[eventType: SecurityEventType, details: Record<string, string | number | boolean | null | undefined>]' of length '2' has no element at index '2'.

[7m615[0m       const loggedData = vi.mocked(logSecurityEvent).mock.calls[0][2]
[7m   [0m [91m                                                                   ~[0m
[96msrc/lib/auth/__tests__/jwt-service.test.ts[0m:[93m603[0m:[93m68[0m - [91merror[0m[90m ts(2493): [0mTuple type '[eventType: SecurityEventType, details: Record<string, string | number | boolean | null | undefined>]' of length '2' has no element at index '2'.

[7m603[0m       const loggedData = vi.mocked(logSecurityEvent).mock.calls[0][2]
[7m   [0m [91m                                                                   ~[0m
[96msrc/lib/auth/__tests__/jwt-service.test.ts[0m:[93m500[0m:[93m9[0m - [91merror[0m[90m ts(2304): [0mCannot find name 'measureTokenOperation'.

[7m500[0m         measureTokenOperation(failingOperation, 'failing_operation'),
[7m   [0m [91m        ~~~~~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/jwt-service.test.ts[0m:[93m483[0m:[93m13[0m - [91merror[0m[90m ts(2304): [0mCannot find name 'measureTokenOperation'.

[7m483[0m       await measureTokenOperation(slowOperation, 'slow_operation')
[7m   [0m [91m            ~~~~~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/jwt-service.test.ts[0m:[93m466[0m:[93m28[0m - [91merror[0m[90m ts(2304): [0mCannot find name 'measureTokenOperation'.

[7m466[0m       const result = await measureTokenOperation(
[7m   [0m [91m                           ~~~~~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/jwt-service.test.ts[0m:[93m445[0m:[93m17[0m - [91merror[0m[90m ts(2304): [0mCannot find name 'getFromCache'.

[7m445[0m       vi.mocked(getFromCache).mockResolvedValue({
[7m   [0m [91m                ~~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/jwt-service.test.ts[0m:[93m314[0m:[93m64[0m - [91merror[0m[90m ts(2304): [0mCannot find name 'mockClientPair'.

[7m314[0m       await refreshAccessToken(originalTokenPair.refreshToken, mockClientPair)
[7m   [0m [91m                                                               ~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/jwt-service.test.ts[0m:[93m559[0m:[93m60[0m - [93mwarning[0m[90m ts(6133): [0m'data' is declared but its value is never read.

[7m559[0m       vi.mocked(setInCache).mockImplementation(async (key, data) => {
[7m   [0m [93m                                                           ~~~~[0m
[96msrc/lib/auth/__tests__/jwt-service.test.ts[0m:[93m425[0m:[93m60[0m - [93mwarning[0m[90m ts(6133): [0m'key' is declared but its value is never read.

[7m425[0m       vi.mocked(removeFromCache).mockImplementation(async (key) => {
[7m   [0m [93m                                                           ~~~[0m
[96msrc/lib/auth/__tests__/jwt-service.test.ts[0m:[93m349[0m:[93m60[0m - [93mwarning[0m[90m ts(6133): [0m'key' is declared but its value is never read.

[7m349[0m       vi.mocked(removeFromCache).mockImplementation(async (key) => {
[7m   [0m [93m                                                           ~~~[0m
[96msrc/lib/auth/__tests__/jwt-service.test.ts[0m:[93m345[0m:[93m60[0m - [93mwarning[0m[90m ts(6133): [0m'data' is declared but its value is never read.

[7m345[0m       vi.mocked(setInCache).mockImplementation(async (key, data) => {
[7m   [0m [93m                                                           ~~~~[0m
[96msrc/lib/auth/__tests__/jwt-service.test.ts[0m:[93m345[0m:[93m55[0m - [93mwarning[0m[90m ts(6133): [0m'key' is declared but its value is never read.

[7m345[0m       vi.mocked(setInCache).mockImplementation(async (key, data) => {
[7m   [0m [93m                                                      ~~~[0m
[96msrc/lib/auth/__tests__/jwt-service.test.ts[0m:[93m310[0m:[93m60[0m - [93mwarning[0m[90m ts(6133): [0m'key' is declared but its value is never read.

[7m310[0m       vi.mocked(removeFromCache).mockImplementation(async (key) => {
[7m   [0m [93m                                                           ~~~[0m
[96msrc/lib/auth/__tests__/jwt-service.test.ts[0m:[93m303[0m:[93m60[0m - [93mwarning[0m[90m ts(6133): [0m'data' is declared but its value is never read.

[7m303[0m       vi.mocked(setInCache).mockImplementation(async (key, data) => {
[7m   [0m [93m                                                           ~~~~[0m
[96msrc/lib/auth/__tests__/jwt-service.test.ts[0m:[93m275[0m:[93m60[0m - [93mwarning[0m[90m ts(6133): [0m'data' is declared but its value is never read.

[7m275[0m       vi.mocked(setInCache).mockImplementation(async (key, data) => {
[7m   [0m [93m                                                           ~~~~[0m
[96msrc/lib/auth/__tests__/jwt-service.test.ts[0m:[93m154[0m:[93m60[0m - [93mwarning[0m[90m ts(6133): [0m'data' is declared but its value is never read.

[7m154[0m       vi.mocked(setInCache).mockImplementation(async (key, data) => {
[7m   [0m [93m                                                           ~~~~[0m

[96msrc/lib/auth/__tests__/middleware.test.ts[0m:[93m1110[0m:[93m28[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'Request' is not assignable to parameter of type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>'.
  Type 'Request' is missing the following properties from type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>': get, header, accepts, acceptsCharsets, and 93 more.

[7m1110[0m       await csrfProtection(postRequest)
[7m    [0m [91m                           ~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/middleware.test.ts[0m:[93m1085[0m:[93m33[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'Request' is not assignable to parameter of type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>'.
  Type 'Request' is missing the following properties from type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>': get, header, accepts, acceptsCharsets, and 93 more.

[7m1085[0m       await rateLimitMiddleware(mockRequest, 'login', 5, 60)
[7m    [0m [91m                                ~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/middleware.test.ts[0m:[93m1063[0m:[93m36[0m - [91merror[0m[90m ts(2352): [0mConversion of type '{ user: { id: string; email: string; role: string; }; tokenId: string; cache: RequestCache; credentials: RequestCredentials; destination: RequestDestination; headers: Headers; integrity: string; ... 16 more ...; text(): Promise<string>; text(): Promise<string>; }' to type 'AuthenticatedRequest' may be a mistake because neither type sufficiently overlaps with the other. If this was intentional, convert the expression to 'unknown' first.
  Type '{ user: { id: string; email: string; role: string; }; tokenId: string; cache: RequestCache; credentials: RequestCredentials; destination: RequestDestination; ... 18 more ...; text(): Promise<...>; text(): Promise<...>; }' is missing the following properties from type 'AuthenticatedRequest': get, header, accepts, acceptsCharsets, and 93 more.

[7m1063[0m       const authenticatedRequest = {
[7m    [0m [91m                                   ~[0m
[7m1064[0m         ...mockRequest,
[7m    [0m [91m~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m ...[0m 
[7m1066[0m         tokenId: 'token123',
[7m    [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[7m1067[0m       } as AuthenticatedRequest
[7m    [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/middleware.test.ts[0m:[93m1048[0m:[93m33[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'Request' is not assignable to parameter of type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>'.
  Type 'Request' is missing the following properties from type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>': get, header, accepts, acceptsCharsets, and 93 more.

[7m1048[0m       await authenticateRequest(mockRequest)
[7m    [0m [91m                                ~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/middleware.test.ts[0m:[93m1016[0m:[93m33[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'Request' is not assignable to parameter of type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>'.
  Type 'Request' is missing the following properties from type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>': get, header, accepts, acceptsCharsets, and 93 more.

[7m1016[0m       await authenticateRequest(mockRequest)
[7m    [0m [91m                                ~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/middleware.test.ts[0m:[93m995[0m:[93m16[0m - [91merror[0m[90m ts(18048): [0m'loggedData' is possibly 'undefined'.

[7m995[0m         expect(loggedData.clientInfo.ip).toBeUndefined()
[7m   [0m [91m               ~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/middleware.test.ts[0m:[93m994[0m:[93m11[0m - [91merror[0m[90m ts(18048): [0m'loggedData' is possibly 'undefined'.

[7m994[0m       if (loggedData.clientInfo) {
[7m   [0m [91m          ~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/middleware.test.ts[0m:[93m991[0m:[93m68[0m - [91merror[0m[90m ts(2493): [0mTuple type '[eventType: SecurityEventType, details: Record<string, string | number | boolean | null | undefined>]' of length '2' has no element at index '2'.

[7m991[0m       const loggedData = vi.mocked(logSecurityEvent).mock.calls[0][2]
[7m   [0m [91m                                                                   ~[0m
[96msrc/lib/auth/__tests__/middleware.test.ts[0m:[93m989[0m:[93m33[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'Request' is not assignable to parameter of type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>'.
  Type 'Request' is missing the following properties from type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>': get, header, accepts, acceptsCharsets, and 93 more.

[7m989[0m       await authenticateRequest(mockRequest)
[7m   [0m [91m                                ~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/middleware.test.ts[0m:[93m964[0m:[93m44[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'Request' is not assignable to parameter of type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>'.
  Type 'Request' is missing the following properties from type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>': get, header, accepts, acceptsCharsets, and 93 more.

[7m964[0m       const result = await securityHeaders(mockRequest, response)
[7m   [0m [91m                                           ~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/middleware.test.ts[0m:[93m961[0m:[93m9[0m - [91merror[0m[90m ts(2353): [0mObject literal may only specify known properties, and 'patient' does not exist in type 'ReadableStream<any> | Blob | ArrayBuffer | ArrayBufferView<ArrayBuffer> | FormData | URLSearchParams'.

[7m961[0m         patient: { name: 'John Doe', condition: 'Anxiety' },
[7m   [0m [91m        ~~~~~~~[0m
[96msrc/lib/auth/__tests__/middleware.test.ts[0m:[93m952[0m:[93m68[0m - [91merror[0m[90m ts(2493): [0mTuple type '[eventType: SecurityEventType, details: Record<string, string | number | boolean | null | undefined>]' of length '2' has no element at index '2'.

[7m952[0m       const loggedData = vi.mocked(logSecurityEvent).mock.calls[0][2]
[7m   [0m [91m                                                                   ~[0m
[96msrc/lib/auth/__tests__/middleware.test.ts[0m:[93m950[0m:[93m33[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'Request' is not assignable to parameter of type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>'.
  Type 'Request' is missing the following properties from type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>': get, header, accepts, acceptsCharsets, and 93 more.

[7m950[0m       await authenticateRequest(mockRequest)
[7m   [0m [91m                                ~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/middleware.test.ts[0m:[93m923[0m:[93m44[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'Request' is not assignable to parameter of type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>'.
  Type 'Request' is missing the following properties from type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>': get, header, accepts, acceptsCharsets, and 93 more.

[7m923[0m       const result = await securityHeaders(mockRequest, response)
[7m   [0m [91m                                           ~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/middleware.test.ts[0m:[93m913[0m:[93m44[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'Request' is not assignable to parameter of type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>'.
  Type 'Request' is missing the following properties from type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>': get, header, accepts, acceptsCharsets, and 93 more.

[7m913[0m       const result = await securityHeaders(mockRequest, response)
[7m   [0m [91m                                           ~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/middleware.test.ts[0m:[93m900[0m:[93m44[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'Request' is not assignable to parameter of type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>'.
  Type 'Request' is missing the following properties from type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>': get, header, accepts, acceptsCharsets, and 93 more.

[7m900[0m       const result = await securityHeaders(mockRequest, response)
[7m   [0m [91m                                           ~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/middleware.test.ts[0m:[93m885[0m:[93m44[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'Request' is not assignable to parameter of type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>'.
  Type 'Request' is missing the following properties from type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>': get, header, accepts, acceptsCharsets, and 93 more.

[7m885[0m       const result = await securityHeaders(mockRequest, response)
[7m   [0m [91m                                           ~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/middleware.test.ts[0m:[93m873[0m:[93m68[0m - [91merror[0m[90m ts(2493): [0mTuple type '[eventType: SecurityEventType, details: Record<string, string | number | boolean | null | undefined>]' of length '2' has no element at index '2'.

[7m873[0m       const loggedData = vi.mocked(logSecurityEvent).mock.calls[0][2]
[7m   [0m [91m                                                                   ~[0m
[96msrc/lib/auth/__tests__/middleware.test.ts[0m:[93m871[0m:[93m33[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'Request' is not assignable to parameter of type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>'.
  Type 'Request' is missing the following properties from type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>': get, header, accepts, acceptsCharsets, and 93 more.

[7m871[0m       await authenticateRequest(mockRequest)
[7m   [0m [91m                                ~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/middleware.test.ts[0m:[93m847[0m:[93m33[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'Request' is not assignable to parameter of type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>'.
  Type 'Request' is missing the following properties from type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>': get, header, accepts, acceptsCharsets, and 93 more.

[7m847[0m       await authenticateRequest(mockRequest)
[7m   [0m [91m                                ~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/middleware.test.ts[0m:[93m837[0m:[93m33[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'Request' is not assignable to parameter of type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>'.
  Type 'Request' is missing the following properties from type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>': get, header, accepts, acceptsCharsets, and 93 more.

[7m837[0m       await authenticateRequest(mockRequest)
[7m   [0m [91m                                ~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/middleware.test.ts[0m:[93m814[0m:[93m33[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'Request' is not assignable to parameter of type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>'.
  Type 'Request' is missing the following properties from type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>': get, header, accepts, acceptsCharsets, and 93 more.

[7m814[0m       await rateLimitMiddleware(mockRequest, 'api', 100, 60)
[7m   [0m [91m                                ~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/middleware.test.ts[0m:[93m801[0m:[93m33[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'Request' is not assignable to parameter of type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>'.
  Type 'Request' is missing the following properties from type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>': get, header, accepts, acceptsCharsets, and 93 more.

[7m801[0m       await authenticateRequest(mockRequest)
[7m   [0m [91m                                ~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/middleware.test.ts[0m:[93m769[0m:[93m44[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'Request' is not assignable to parameter of type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>'.
  Type 'Request' is missing the following properties from type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>': get, header, accepts, acceptsCharsets, and 93 more.

[7m769[0m       const result = await securityHeaders(optionsRequest, response)
[7m   [0m [91m                                           ~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/middleware.test.ts[0m:[93m742[0m:[93m44[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'Request' is not assignable to parameter of type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>'.
  Type 'Request' is missing the following properties from type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>': get, header, accepts, acceptsCharsets, and 93 more.

[7m742[0m       const result = await securityHeaders(apiRequest, response)
[7m   [0m [91m                                           ~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/middleware.test.ts[0m:[93m725[0m:[93m44[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'Request' is not assignable to parameter of type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>'.
  Type 'Request' is missing the following properties from type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>': get, header, accepts, acceptsCharsets, and 93 more.

[7m725[0m       const result = await securityHeaders(mockRequest, response)
[7m   [0m [91m                                           ~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/middleware.test.ts[0m:[93m714[0m:[93m44[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'Request' is not assignable to parameter of type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>'.
  Type 'Request' is missing the following properties from type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>': get, header, accepts, acceptsCharsets, and 93 more.

[7m714[0m       const result = await securityHeaders(mockRequest, response)
[7m   [0m [91m                                           ~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/middleware.test.ts[0m:[93m698[0m:[93m44[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'Request' is not assignable to parameter of type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>'.
  Type 'Request' is missing the following properties from type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>': get, header, accepts, acceptsCharsets, and 93 more.

[7m698[0m       const result = await securityHeaders(mockRequest, response)
[7m   [0m [91m                                           ~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/middleware.test.ts[0m:[93m684[0m:[93m44[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'Request' is not assignable to parameter of type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>'.
  Type 'Request' is missing the following properties from type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>': get, header, accepts, acceptsCharsets, and 93 more.

[7m684[0m       const result = await securityHeaders(mockRequest, response)
[7m   [0m [91m                                           ~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/middleware.test.ts[0m:[93m666[0m:[93m44[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'Request' is not assignable to parameter of type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>'.
  Type 'Request' is missing the following properties from type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>': get, header, accepts, acceptsCharsets, and 93 more.

[7m666[0m       const result = await securityHeaders(mockRequest, response)
[7m   [0m [91m                                           ~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/middleware.test.ts[0m:[93m653[0m:[93m45[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'Request' is not assignable to parameter of type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>'.
  Type 'Request' is missing the following properties from type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>': get, header, accepts, acceptsCharsets, and 93 more.

[7m653[0m         const result = await csrfProtection(request)
[7m   [0m [91m                                            ~~~~~~~[0m
[96msrc/lib/auth/__tests__/middleware.test.ts[0m:[93m619[0m:[93m28[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'Request' is not assignable to parameter of type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>'.
  Type 'Request' is missing the following properties from type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>': get, header, accepts, acceptsCharsets, and 93 more.

[7m619[0m       await csrfProtection(postRequest)
[7m   [0m [91m                           ~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/middleware.test.ts[0m:[93m595[0m:[93m43[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'Request' is not assignable to parameter of type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>'.
  Type 'Request' is missing the following properties from type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>': get, header, accepts, acceptsCharsets, and 93 more.

[7m595[0m       const result = await csrfProtection(postRequest)
[7m   [0m [91m                                          ~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/middleware.test.ts[0m:[93m571[0m:[93m43[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'Request' is not assignable to parameter of type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>'.
  Type 'Request' is missing the following properties from type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>': get, header, accepts, acceptsCharsets, and 93 more.

[7m571[0m       const result = await csrfProtection(postRequest)
[7m   [0m [91m                                          ~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/middleware.test.ts[0m:[93m547[0m:[93m43[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'Request' is not assignable to parameter of type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>'.
  Type 'Request' is missing the following properties from type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>': get, header, accepts, acceptsCharsets, and 93 more.

[7m547[0m       const result = await csrfProtection(postRequest)
[7m   [0m [91m                                          ~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/middleware.test.ts[0m:[93m536[0m:[93m43[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'Request' is not assignable to parameter of type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>'.
  Type 'Request' is missing the following properties from type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>': get, header, accepts, acceptsCharsets, and 93 more.

[7m536[0m       const result = await csrfProtection(postRequest)
[7m   [0m [91m                                          ~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/middleware.test.ts[0m:[93m513[0m:[93m43[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'Request' is not assignable to parameter of type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>'.
  Type 'Request' is missing the following properties from type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>': get, header, accepts, acceptsCharsets, and 93 more.

[7m513[0m       const result = await csrfProtection(getRequest)
[7m   [0m [91m                                          ~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/middleware.test.ts[0m:[93m503[0m:[93m33[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'Request' is not assignable to parameter of type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>'.
  Type 'Request' is missing the following properties from type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>': get, header, accepts, acceptsCharsets, and 93 more.

[7m503[0m       await rateLimitMiddleware(requestWithoutIP, 'login', 5, 60)
[7m   [0m [91m                                ~~~~~~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/middleware.test.ts[0m:[93m485[0m:[93m33[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'Request' is not assignable to parameter of type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>'.
  Type 'Request' is missing the following properties from type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>': get, header, accepts, acceptsCharsets, and 93 more.

[7m485[0m       await rateLimitMiddleware(mockRequest, 'login', 5, 60)
[7m   [0m [91m                                ~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/middleware.test.ts[0m:[93m463[0m:[93m33[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'Request' is not assignable to parameter of type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>'.
  Type 'Request' is missing the following properties from type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>': get, header, accepts, acceptsCharsets, and 93 more.

[7m463[0m       await rateLimitMiddleware(mockRequest, 'login', 5, 60)
[7m   [0m [91m                                ~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/middleware.test.ts[0m:[93m440[0m:[93m33[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'Request' is not assignable to parameter of type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>'.
  Type 'Request' is missing the following properties from type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>': get, header, accepts, acceptsCharsets, and 93 more.

[7m440[0m       await rateLimitMiddleware(mockRequest, 'api', 100, 60)
[7m   [0m [91m                                ~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/middleware.test.ts[0m:[93m437[0m:[93m33[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'Request' is not assignable to parameter of type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>'.
  Type 'Request' is missing the following properties from type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>': get, header, accepts, acceptsCharsets, and 93 more.

[7m437[0m       await rateLimitMiddleware(mockRequest, 'login', 5, 60)
[7m   [0m [91m                                ~~~~~~~~~~~[0m
[96msrc/lib/auth/__tests__/middleware.test.ts[0m:[93m416[0m:[93m48[0m - [91merror[0m[90m ts(2345): [0mArgument of type 'Request' is not assignable to parameter of type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>'.
  Type 'Request' is missing the following properties from type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>': get, header, accepts, acceptsCharsets, and 93 more.
