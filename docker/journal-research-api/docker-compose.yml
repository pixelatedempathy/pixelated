
services:
  journal-research-api:
    build:
      context: ../..
      dockerfile: docker/journal-research-api/Dockerfile
    container_name: journal-research-api
    restart: unless-stopped
    ports:
      - "8000:8000"
    environment:
      # Server configuration
      - HOST=0.0.0.0
      - PORT=8000
      - ENVIRONMENT=${ENVIRONMENT:-production}
      - API_VERSION=1.0.0
      - DEBUG=${DEBUG:-false}
      
      # CORS configuration
      - CORS_ORIGINS=${CORS_ORIGINS:-http://localhost:4321,http://localhost:3000}
      
      # Authentication
      - AUTH_ENABLED=${AUTH_ENABLED:-true}
      - JWT_SECRET=${JWT_SECRET:-}
      - JWT_ALGORITHM=${JWT_ALGORITHM:-HS256}
      - JWT_EXPIRATION_MINUTES=${JWT_EXPIRATION_MINUTES:-1440}
      
      # Rate limiting
      - RATE_LIMIT_ENABLED=${RATE_LIMIT_ENABLED:-true}
      - RATE_LIMIT_PER_MINUTE=${RATE_LIMIT_PER_MINUTE:-60}
      - RATE_LIMIT_PER_HOUR=${RATE_LIMIT_PER_HOUR:-1000}
      
      # Logging
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      
      # Session storage
      - SESSION_STORAGE_PATH=${SESSION_STORAGE_PATH:-/app/sessions}
    volumes:
      - journal-research-sessions:/app/sessions
    networks:
      - journal-research-network
    healthcheck:
      test: ["CMD", "python", "-c", "import requests; requests.get('http://localhost:8000/health', timeout=5).raise_for_status()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    deploy:
      resources:
        limits:
          cpus: '2.0'
          memory: 2G
        reservations:
          cpus: '0.5'
          memory: 512M

volumes:
  journal-research-sessions:
    driver: local

networks:
  journal-research-network:
    driver: bridge

