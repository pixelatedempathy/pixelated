# Alternative secure Dockerfile using scratch base
FROM prom/alertmanager:v0.27.0 AS source

FROM scratch

# Copy only the essential files
COPY --from=source /bin/alertmanager /alertmanager
COPY --from=source /etc/ssl/certs/ca-certificates.crt /etc/ssl/certs/
COPY alertmanager.yml /etc/alertmanager/alertmanager.yml

# Use nobody user
USER 65534:65534

EXPOSE 9093

ENTRYPOINT ["/alertmanager"]
CMD ["--config.file=/etc/alertmanager/alertmanager.yml", "--storage.path=/tmp"]

HEALTHCHECK --interval=30s --timeout=5s --start-period=10s --retries=3 CMD wget --spider -q http://localhost:9093/-/ready || exit 1
